// Bravey v0.1 - http://github.com/braveyjs/bravey - MIT Licensed
var Bravey={REVISION:"0.1"};"function"==typeof define&&define.amd?define("Bravey",Bravey):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=Bravey),Bravey.DATA={},Bravey.Language={},Bravey.Nlp={},Bravey.Filter={},Bravey.SessionManager={},Bravey.File={},Bravey.File.load=function(e,t,r,n){if("undefined"!=typeof module&&module.exports)Bravey.DATA.fs||(Bravey.DATA.fs=require("fs")),t(Bravey.DATA.fs.readFileSync(e,"utf8"));else{var i=null;i=new XMLHttpRequest,i.onreadystatechange=function(){4==i.readyState&&(200==i.status?t(i.responseText):t())},i.open(r||"GET",e),i.send(null)}},Bravey.Text={},Bravey.Text.WORDSEP="[^(a-zA-ZA-Яa-я0-9_!?.:)+s]*",Bravey.Text.TRIMSTART=new RegExp("^("+Bravey.Text.WORDSEP+")","gi"),Bravey.Text.TRIMEND=new RegExp("("+Bravey.Text.WORDSEP+")$","gi"),Bravey.Text.generateGUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Bravey.Text.calculateScore=function(e,t){for(var r=0,n=0;n<t.length;n++)e[t[n]]&&r++;return r},Bravey.Text.entityTrim=function(e){var t=e.string.match(Bravey.Text.TRIMSTART),r=e.string.match(Bravey.Text.TRIMEND),n=t?t[0].length:0,i=r?r[0].length:0;return e.position+=n,e.string=e.string.substr(n,e.string.length-n-i),e},Bravey.Text.RegexMap=function(e,t){for(var r=0;r<e.length;r++){e[r].mtch=[];for(var n=0;n<e[r].str.length;n++)e[r].mtch.push(e[r].str[n].replace(/~/g,""))}this.regex=function(t){for(var r="(",n=0;n<e.length;n++)for(var i=0;i<e[n].str.length;i++)r+=e[n].str[i].replace(/~/g,"\\b")+"|";return r.substr(0,r.length-1)+")"+(t?"":"?")},this.get=function(r,n,i){for(var a=0;a<e.length;a++)for(var s=0;s<e[a].mtch.length;s++)if(r[n]==e[a].mtch[s])return e[a].val;return void 0==i?t:i}},Bravey.Text.unique=function(e){for(var t={},r=[],n=0,i=e.length;n<i;++n)t.hasOwnProperty(e[n])||(r.push(e[n]),t[e[n]]=1);return r},Bravey.Text.clean=function(e){return Bravey.Text.removeDiacritics(e).toLowerCase().trim().replace(/ +(?= )/g,"").replace(/[()\[\]]/g,"")},Bravey.Text.pad=function(e,t,r){return r=r||"0",e+="",e.length>=t?e:new Array(t-e.length+1).join(r)+e},Bravey.Text.tokenize=function(e){var t=e.replace(/[^(a-zA-ZA-Яa-я0-9_)+\s]/g," ").trim().replace(/ +(?= )/g,"");return Bravey.Text.unique(t.split(/\s+/))},Bravey.DATA.diacriticsMap={},Bravey.Text.removeDiacritics=function(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return Bravey.DATA.diacriticsMap[e]||e})},function(){defaultDiacriticsRemovalap=[{base:" ",letters:" "},{base:"0",letters:"߀"},{base:"A",letters:"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"ⒷＢḂḄḆɃƁ"},{base:"C",letters:"ⒸＣꜾḈĆCĈĊČÇƇȻ"},{base:"D",letters:"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ"},{base:"Dh",letters:"Ð"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ"},{base:"F",letters:"ꝼⒻＦḞƑꝻ"},{base:"G",letters:"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ"},{base:"H",letters:"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"ⒿＪĴɈȷ"},{base:"K",letters:"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"ⓂＭḾṀṂⱮƜϻ"},{base:"N",letters:"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OE",letters:"Œ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"ⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"ⓆＱꝖꝘɊ"},{base:"R",letters:"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"ⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"ⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"ⓍＸẊẌ"},{base:"Y",letters:"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"ⓑｂḃḅḇƀƃɓƂ"},{base:"c",letters:"ｃⓒćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ"},{base:"dh",letters:"ð"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ"},{base:"f",letters:"ⓕｆḟƒ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ"},{base:"h",letters:"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"ⓙｊĵǰɉ"},{base:"k",letters:"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"ⓜｍḿṁṃɱɯ"},{base:"n",letters:"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ"},{base:"oe",letters:"œ"},{base:"oi",letters:"ƣ"},{base:"oo",letters:"ꝏ"},{base:"ou",letters:"ȣ"},{base:"p",letters:"ⓟｐṕṗƥᵽꝑꝓꝕρ"},{base:"q",letters:"ⓠｑɋꝗꝙ"},{base:"r",letters:"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ"},{base:"ss",letters:"ß"},{base:"t",letters:"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"ⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"ⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"ⓧｘẋẍ"},{base:"y",letters:"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"ⓩｚźẑżžẓẕƶȥɀⱬꝣ"}];for(var e=0;e<defaultDiacriticsRemovalap.length;e++)for(var t=defaultDiacriticsRemovalap[e].letters,r=0;r<t.length;r++)Bravey.DATA.diacriticsMap[t[r]]=defaultDiacriticsRemovalap[e].base}(),Bravey.Date={},Bravey.Date.SECOND=1e3,Bravey.Date.MINUTE=60*Bravey.Date.SECOND,Bravey.Date.HOUR=60*Bravey.Date.MINUTE,Bravey.Date.DAY=24*Bravey.Date.HOUR,Bravey.Date.formatDate=function(e){var t=new Date(e);return Bravey.Text.pad(t.getFullYear(),4)+"-"+Bravey.Text.pad(t.getMonth()+1,2)+"-"+Bravey.Text.pad(t.getDate(),2)},Bravey.Date.formatTime=function(e){return Bravey.Text.pad(Math.floor(e/Bravey.Date.HOUR),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.HOUR/Bravey.Date.MINUTE),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.MINUTE/Bravey.Date.SECOND),2)},Bravey.Date.centuryFinder=function(e){return e<100?e>20?e+1900:e+2e3:e},Bravey.Data={},Bravey.Data.getEntityValue=function(e,t,r){var n;return e&&(void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[t]&&(n=e.result.entitiesIndex[t].value),n==r&&(n=void 0),void 0==n&&void 0!==e.sessionData&&(n=e.sessionData[t])),n},Bravey.Data.isExplicit=function(e,t){return e&&void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[t]},Bravey.stemmerSupport={Among:function(e,t,r,n){if(this.toCharArray=function(e){for(var t=e.length,r=new Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r},!e&&""!=e||!t&&0!=t||!r)throw"Bad Among initialisation: s:"+e+", substring_i: "+t+", result: "+r;this.s_size=e.length,this.s=this.toCharArray(e),this.substring_i=t,this.result=r,this.method=n},SnowballProgram:function(){var e;return{bra:0,ket:0,limit:0,cursor:0,limit_backward:0,setCurrent:function(t){e=t,this.cursor=0,this.limit=t.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit},getCurrent:function(){var t=e;return e=null,t},in_grouping:function(t,r,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i<=n&&i>=r&&(i-=r,t[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},in_grouping_b:function(t,r,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i<=n&&i>=r&&(i-=r,t[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},out_grouping:function(t,r,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i>n||i<r)return this.cursor++,!0;if(i-=r,!(t[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},out_grouping_b:function(t,r,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i>n||i<r)return this.cursor--,!0;if(i-=r,!(t[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},eq_s:function(t,r){if(this.limit-this.cursor<t)return!1;for(var n=0;n<t;n++)if(e.charCodeAt(this.cursor+n)!=r.charCodeAt(n))return!1;return this.cursor+=t,!0},eq_s_b:function(t,r){if(this.cursor-this.limit_backward<t)return!1;for(var n=0;n<t;n++)if(e.charCodeAt(this.cursor-t+n)!=r.charCodeAt(n))return!1;return this.cursor-=t,!0},find_among:function(t,r){for(var n=0,i=r,a=this.cursor,s=this.limit,o=0,u=0,c=!1;;){for(var l=n+(i-n>>1),f=0,g=o<u?o:u,v=t[l],d=g;d<v.s_size;d++){if(a+g==s){f=-1;break}if(f=e.charCodeAt(a+g)-v.s[d])break;g++}if(f<0?(i=l,u=g):(n=l,o=g),i-n<=1){if(n>0||i==n||c)break;c=!0}}for(;;){var v=t[n];if(o>=v.s_size){if(this.cursor=a+v.s_size,!v.method)return v.result;var b=v.method();if(this.cursor=a+v.s_size,b)return v.result}if(n=v.substring_i,n<0)return 0}},find_among_b:function(t,r){for(var n=0,i=r,a=this.cursor,s=this.limit_backward,o=0,u=0,c=!1;;){for(var l=n+(i-n>>1),f=0,g=o<u?o:u,v=t[l],d=v.s_size-1-g;d>=0;d--){if(a-g==s){f=-1;break}if(f=e.charCodeAt(a-1-g)-v.s[d])break;g++}if(f<0?(i=l,u=g):(n=l,o=g),i-n<=1){if(n>0||i==n||c)break;c=!0}}for(;;){var v=t[n];if(o>=v.s_size){if(this.cursor=a-v.s_size,!v.method)return v.result;var b=v.method();if(this.cursor=a-v.s_size,b)return v.result}if(n=v.substring_i,n<0)return 0}},replace_s:function(t,r,n){var i=n.length-(r-t),a=e.substring(0,t),s=e.substring(r);return e=a+n+s,this.limit+=i,this.cursor>=r?this.cursor+=i:this.cursor>t&&(this.cursor=t),i},slice_check:function(){if(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>e.length)throw"faulty slice operation"},slice_from:function(e){this.slice_check(),this.replace_s(this.bra,this.ket,e)},slice_del:function(){this.slice_from("")},insert:function(e,t,r){var n=this.replace_s(e,t,r);e<=this.bra&&(this.bra+=n),e<=this.ket&&(this.ket+=n)},slice_to:function(){return this.slice_check(),e.substring(this.bra,this.ket)},eq_v_b:function(e){return this.eq_s_b(e.length,e)}}}},Bravey.FreeTextEntityRecognizer=function(e,t){var r=/\"([^\"]*)\"/,n=[],i=[];this.getName=function(){return e},this.addPrefix=function(e){n.indexOf(e)==-1&&n.push(e)},this.addConjunction=function(e){i.push(new RegExp("^\\b"+e+"\\b","gi")),i.push(new RegExp("\\b"+e+"\\b$","gi"))},this.getEntities=function(e,t){return t},this.expand=function(e){var t,a,s=-1,o=-1;if(null!=(a=r.exec(e.string)))e.position+=a.index+1,e.string=a[1];else{for(var u=0;u<n.length;u++)(t=e.string.indexOf(n[u]))!=-1&&(o==-1||t<o)&&(o=t,s=t+n[u].length);s!=-1&&(e.position+=s,e.string=e.string.substr(s)),Bravey.Text.entityTrim(e);do{o=0;for(var u=0;u<i.length;u++)null!=(a=i[u].exec(e.string))&&(o=1,0==a.index?(e.string=e.string.substr(a[0].length),e.position+=a[0].length):e.string=e.string.substr(0,a.index),Bravey.Text.entityTrim(e))}while(o);(t=e.string.lastIndexOf("."))!=-1&&(e.string=e.string.substr(0,t)),Bravey.Text.entityTrim(e)}e.value=e.string}},Bravey.StringEntityRecognizer=function(e,t){function r(){n.sort(function(e,t){return e.text.length>t.text.length?-1:e.text.length<t.text.length?1:0})}var n=[],i={},a=!1;this.getName=function(){return e},this.addMatch=function(e,t){return t=Bravey.Text.clean(t),i[t]||(i[t]=1,a=!1,n.push({text:t,id:e,regex:new RegExp("\\b"+t+"\\b","gi")})),!0},this.getEntities=function(i,s){i=Bravey.Text.clean(i),a||(a=!0,r());var o,u;s||(s=[]);for(var c,l=i,f=0;f<n.length;f++)for(;null!=(u=n[f].regex.exec(l));){o=i.substr(u.index,u[0].length),s.push({position:u.index,entity:e,value:n[f].id,string:o,priority:t||0}),c=l.substr(0,u.index);for(var g=0;g<u[0].length;g++)c+=" ";c+=l.substr(u.index+u[0].length),l=c}return s}},Bravey.NumberEntityRecognizer=function(e){var t=new RegExp("\\b[0-9]+\\b","gi");this.getName=function(){return e},this.getEntities=function(r,n){r=Bravey.Text.clean(r);var i,a;n||(n=[]);for(var s=r;null!=(a=t.exec(s));)i=r.substr(a.index,a[0].length),n.push({position:a.index,entity:e,value:1*i,string:i});return n}},Bravey.RegexEntityRecognizer=function(e){function t(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}var r=[];this.addMatch=function(e,t,n){r.push({regex:e,callback:t,priority:n||0})},this.getName=function(){return e},this.getEntities=function(n,i){n=Bravey.Text.clean(n);var a,s,o,u=[],c=-1;i||(i=[]);for(var l=n,f=0;f<r.length;f++)for(;null!=(o=r[f].regex.exec(l));)s=n.substr(o.index,o[0].length),a=r[f].callback(o),void 0!==a&&u.push(Bravey.Text.entityTrim({value:a,entity:e,position:o.index,string:s,priority:r[f].priority}));t(u);for(var f=0;f<u.length;f++)u[f].position>=c&&(i.push(u[f]),c=u[f].position+u[f].string.length);return i},this.bindTo=function(e){var t=this;e.getName=function(){return t.getName()},e.getEntities=function(e,r){return t.getEntities(e,r)}}},Bravey.EMailEntityRecognizer=function(e,t){var r=/(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/g;this.getName=function(){return e},this.getEntities=function(n,i){var a;for(i||(i=[]);null!=(a=r.exec(n));)piece=n.substr(a.index,a[0].length),i.push({position:a.index,entity:e,value:piece,string:piece,priority:t||0});return i}},Bravey.DocumentClassifier=function(e){e=e||{};var t={},r=function(e,t){return"stem:"+e+"::label:"+t},n=function(e){return"docCount:"+e},i=function(e){return"stemCount:"+e},a=function(e){},s=function(){var e=t.registeredLabels;return e||(e=""),e.split(",").filter(function(e){return e.length})},o=function(e){var r=s();return r.indexOf(e)===-1&&(r.push(e),t.registeredLabels=r.join(",")),!0},u=function(e,n){var i=parseInt(t[r(e,n)]);return i||(i=0),i},c=function(e,t){for(var r=s(),n=0,i=0,a=r.length;i<a;i++)r[i]!==t&&(n+=parseInt(u(e,r[i])));return n},l=function(e){var r=parseInt(t[i(e)]);return r||(r=0),r},f=function(e){var r=parseInt(t[n(e)]);return r||(r=0),r},g=function(e){for(var t=s(),r=0,n=0,i=t.length;n<i;n++)t[n]!==e&&(r+=parseInt(f(t[n])));return r},v=function(e){var r=parseInt(t[e]);return r||(r=0),t[e]=parseInt(r)+1,r+1},d=function(e,t){v(i(e)),v(r(e,t))},b=function(e){return v(n(e))},m=function(t,r){o(r);var n=Bravey.Text.tokenize(Bravey.Text.clean(t));e.filter&&(n=e.filter(n));for(var i=n.length,a=0;a<i;a++)d(e.stemmer?e.stemmer(n[a]):n[a],r);b(r)},w=function(t){var r=Bravey.Text.tokenize(Bravey.Text.clean(t));e.filter&&(r=e.filter(r));for(var n=r.length,i=s(),o=0,v={},d={},b={},m={},w=0;w<i.length;w++){var h=i[w];v[h]=f(h),d[h]=g(h),o+=parseInt(v[h])}for(var w=0;w<i.length;w++){var h=i[w],y=0;m[h]=v[h]/o;for(var p=0;p<n;p++){var x=e.stemmer?e.stemmer(r[p]):r[p],_=l(x);if(0!==_){var B=u(x,h)/v[h],D=c(x,h)/d[h],T=B/(B+D);T=(.5+_*T)/(1+_),0===T?T=.01:1===T&&(T=.99),y+=Math.log(1-T)-Math.log(T),a(h+"icity of "+x+": "+T)}}b[h]=1/(1+Math.exp(y))}return b},h=function(e){var t=0,r=null;for(var n in e)e[n]>t&&(t=e[n],r=n);return{label:r,score:t}};this.addDocument=function(e,t){return m(e,t),e},this.classifyDocument=function(e){var t=w(e),r=h(t);return{scores:t,winner:r}},this.addDocument("","none")},Bravey.Language.IT={},Bravey.Language.IT.Stemmer=function(){var e=Bravey.stemmerSupport.Among,t=Bravey.stemmerSupport.SnowballProgram,r=new function(){function r(e,t,r){return!(!I.eq_s(1,e)||(I.ket=I.cursor,!I.in_grouping(S,97,249)))&&(I.slice_from(t),I.cursor=r,!0)}function n(){for(var e,t,n,i,a=I.cursor;;){if(I.bra=I.cursor,e=I.find_among(x,7))switch(I.ket=I.cursor,e){case 1:I.slice_from("à");continue;case 2:I.slice_from("è");continue;case 3:I.slice_from("ì");continue;case 4:I.slice_from("ò");continue;case 5:I.slice_from("ù");continue;case 6:I.slice_from("qU");continue;case 7:if(I.cursor>=I.limit)break;I.cursor++;continue}break}for(I.cursor=a;;)for(t=I.cursor;;){if(n=I.cursor,I.in_grouping(S,97,249)){if(I.bra=I.cursor,i=I.cursor,r("u","U",n))break;if(I.cursor=i,r("i","I",n))break}if(I.cursor=n,I.cursor>=I.limit)return void(I.cursor=t);I.cursor++}}function i(e){if(I.cursor=e,!I.in_grouping(S,97,249))return!1;for(;!I.out_grouping(S,97,249);){if(I.cursor>=I.limit)return!1;I.cursor++}return!0}function a(){if(I.in_grouping(S,97,249)){var e=I.cursor;if(I.out_grouping(S,97,249)){for(;!I.in_grouping(S,97,249);){if(I.cursor>=I.limit)return i(e);I.cursor++}return!0}return i(e)}return!1}function s(){var e,t=I.cursor;if(!a()){if(I.cursor=t,!I.out_grouping(S,97,249))return;if(e=I.cursor,I.out_grouping(S,97,249)){for(;!I.in_grouping(S,97,249);){if(I.cursor>=I.limit)return I.cursor=e,void(I.in_grouping(S,97,249)&&I.cursor<I.limit&&I.cursor++);I.cursor++}return void(p=I.cursor)}if(I.cursor=e,!I.in_grouping(S,97,249)||I.cursor>=I.limit)return;I.cursor++}p=I.cursor}function o(){for(;!I.in_grouping(S,97,249);){if(I.cursor>=I.limit)return!1;I.cursor++}for(;!I.out_grouping(S,97,249);){if(I.cursor>=I.limit)return!1;I.cursor++}return!0}function u(){var e=I.cursor;p=I.limit,y=p,h=p,s(),I.cursor=e,o()&&(y=I.cursor,o()&&(h=I.cursor))}function c(){for(var e;;){if(I.bra=I.cursor,e=I.find_among(_,3),!e)break;switch(I.ket=I.cursor,e){case 1:I.slice_from("i");break;case 2:I.slice_from("u");break;case 3:if(I.cursor>=I.limit)return;I.cursor++}}}function l(){return p<=I.cursor}function f(){return y<=I.cursor}function g(){return h<=I.cursor}function v(){var e;if(I.ket=I.cursor,I.find_among_b(B,37)&&(I.bra=I.cursor,e=I.find_among_b(D,5),e&&l()))switch(e){case 1:I.slice_del();break;case 2:I.slice_from("e")}}function d(){var e;if(I.ket=I.cursor,e=I.find_among_b(k,51),!e)return!1;switch(I.bra=I.cursor,e){case 1:if(!g())return!1;I.slice_del();break;case 2:if(!g())return!1;I.slice_del(),I.ket=I.cursor,I.eq_s_b(2,"ic")&&(I.bra=I.cursor,g()&&I.slice_del());break;case 3:if(!g())return!1;I.slice_from("log");break;case 4:if(!g())return!1;I.slice_from("u");break;case 5:if(!g())return!1;I.slice_from("ente");break;case 6:if(!l())return!1;I.slice_del();break;case 7:if(!f())return!1;I.slice_del(),I.ket=I.cursor,e=I.find_among_b(T,4),e&&(I.bra=I.cursor,g()&&(I.slice_del(),1==e&&(I.ket=I.cursor,I.eq_s_b(2,"at")&&(I.bra=I.cursor,g()&&I.slice_del()))));break;case 8:if(!g())return!1;I.slice_del(),I.ket=I.cursor,e=I.find_among_b(E,3),e&&(I.bra=I.cursor,1==e&&g()&&I.slice_del());break;case 9:if(!g())return!1;I.slice_del(),I.ket=I.cursor,I.eq_s_b(2,"at")&&(I.bra=I.cursor,g()&&(I.slice_del(),I.ket=I.cursor,I.eq_s_b(2,"ic")&&(I.bra=I.cursor,g()&&I.slice_del())))}return!0}function b(){var e,t;I.cursor>=p&&(t=I.limit_backward,I.limit_backward=p,I.ket=I.cursor,e=I.find_among_b(R,87),e&&(I.bra=I.cursor,1==e&&I.slice_del()),I.limit_backward=t)}function m(){var e=I.limit-I.cursor;return I.ket=I.cursor,I.in_grouping_b(M,97,242)&&(I.bra=I.cursor,l()&&(I.slice_del(),I.ket=I.cursor,I.eq_s_b(1,"i")&&(I.bra=I.cursor,l())))?void I.slice_del():void(I.cursor=I.limit-e)}function w(){m(),I.ket=I.cursor,I.eq_s_b(1,"h")&&(I.bra=I.cursor,I.in_grouping_b(C,99,103)&&l()&&I.slice_del())}var h,y,p,x=[new e("",-1,7),new e("qu",0,6),new e("á",0,1),new e("é",0,2),new e("í",0,3),new e("ó",0,4),new e("ú",0,5)],_=[new e("",-1,3),new e("I",0,1),new e("U",0,2)],B=[new e("la",-1,-1),new e("cela",0,-1),new e("gliela",0,-1),new e("mela",0,-1),new e("tela",0,-1),new e("vela",0,-1),new e("le",-1,-1),new e("cele",6,-1),new e("gliele",6,-1),new e("mele",6,-1),new e("tele",6,-1),new e("vele",6,-1),new e("ne",-1,-1),new e("cene",12,-1),new e("gliene",12,-1),new e("mene",12,-1),new e("sene",12,-1),new e("tene",12,-1),new e("vene",12,-1),new e("ci",-1,-1),new e("li",-1,-1),new e("celi",20,-1),new e("glieli",20,-1),new e("meli",20,-1),new e("teli",20,-1),new e("veli",20,-1),new e("gli",20,-1),new e("mi",-1,-1),new e("si",-1,-1),new e("ti",-1,-1),new e("vi",-1,-1),new e("lo",-1,-1),new e("celo",31,-1),new e("glielo",31,-1),new e("melo",31,-1),new e("telo",31,-1),new e("velo",31,-1)],D=[new e("ando",-1,1),new e("endo",-1,1),new e("ar",-1,2),new e("er",-1,2),new e("ir",-1,2)],T=[new e("ic",-1,-1),new e("abil",-1,-1),new e("os",-1,-1),new e("iv",-1,1)],E=[new e("ic",-1,1),new e("abil",-1,1),new e("iv",-1,1)],k=[new e("ica",-1,1),new e("logia",-1,3),new e("osa",-1,1),new e("ista",-1,1),new e("iva",-1,9),new e("anza",-1,1),new e("enza",-1,5),new e("ice",-1,1),new e("atrice",7,1),new e("iche",-1,1),new e("logie",-1,3),new e("abile",-1,1),new e("ibile",-1,1),new e("usione",-1,4),new e("azione",-1,2),new e("uzione",-1,4),new e("atore",-1,2),new e("ose",-1,1),new e("ante",-1,1),new e("mente",-1,1),new e("amente",19,7),new e("iste",-1,1),new e("ive",-1,9),new e("anze",-1,1),new e("enze",-1,5),new e("ici",-1,1),new e("atrici",25,1),new e("ichi",-1,1),new e("abili",-1,1),new e("ibili",-1,1),new e("ismi",-1,1),new e("usioni",-1,4),new e("azioni",-1,2),new e("uzioni",-1,4),new e("atori",-1,2),new e("osi",-1,1),new e("anti",-1,1),new e("amenti",-1,6),new e("imenti",-1,6),new e("isti",-1,1),new e("ivi",-1,9),new e("ico",-1,1),new e("ismo",-1,1),new e("oso",-1,1),new e("amento",-1,6),new e("imento",-1,6),new e("ivo",-1,9),new e("ità",-1,8),new e("istà",-1,1),new e("istè",-1,1),new e("istì",-1,1)],R=[new e("isca",-1,1),new e("enda",-1,1),new e("ata",-1,1),new e("ita",-1,1),new e("uta",-1,1),new e("ava",-1,1),new e("eva",-1,1),new e("iva",-1,1),new e("erebbe",-1,1),new e("irebbe",-1,1),new e("isce",-1,1),new e("ende",-1,1),new e("are",-1,1),new e("ere",-1,1),new e("ire",-1,1),new e("asse",-1,1),new e("ate",-1,1),new e("avate",16,1),new e("evate",16,1),new e("ivate",16,1),new e("ete",-1,1),new e("erete",20,1),new e("irete",20,1),new e("ite",-1,1),new e("ereste",-1,1),new e("ireste",-1,1),new e("ute",-1,1),new e("erai",-1,1),new e("irai",-1,1),new e("isci",-1,1),new e("endi",-1,1),new e("erei",-1,1),new e("irei",-1,1),new e("assi",-1,1),new e("ati",-1,1),new e("iti",-1,1),new e("eresti",-1,1),new e("iresti",-1,1),new e("uti",-1,1),new e("avi",-1,1),new e("evi",-1,1),new e("ivi",-1,1),new e("isco",-1,1),new e("ando",-1,1),new e("endo",-1,1),new e("Yamo",-1,1),new e("iamo",-1,1),new e("avamo",-1,1),new e("evamo",-1,1),new e("ivamo",-1,1),new e("eremo",-1,1),new e("iremo",-1,1),new e("assimo",-1,1),new e("ammo",-1,1),new e("emmo",-1,1),new e("eremmo",54,1),new e("iremmo",54,1),new e("immo",-1,1),new e("ano",-1,1),new e("iscano",58,1),new e("avano",58,1),new e("evano",58,1),new e("ivano",58,1),new e("eranno",-1,1),new e("iranno",-1,1),new e("ono",-1,1),new e("iscono",65,1),new e("arono",65,1),new e("erono",65,1),new e("irono",65,1),new e("erebbero",-1,1),new e("irebbero",-1,1),new e("assero",-1,1),new e("essero",-1,1),new e("issero",-1,1),new e("ato",-1,1),new e("ito",-1,1),new e("uto",-1,1),new e("avo",-1,1),new e("evo",-1,1),new e("ivo",-1,1),new e("ar",-1,1),new e("ir",-1,1),new e("erà",-1,1),new e("irà",-1,1),new e("erò",-1,1),new e("irò",-1,1)],S=[17,65,16,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2,1],M=[17,65,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2],C=[17],I=new t;this.setCurrent=function(e){I.setCurrent(e)},this.getCurrent=function(){return I.getCurrent()},this.stem=function(){var e=I.cursor;return n(),I.cursor=e,u(),I.limit_backward=e,I.cursor=I.limit,v(),I.cursor=I.limit,d()||(I.cursor=I.limit,b()),I.cursor=I.limit,w(),I.cursor=I.limit_backward,c(),!0}};return function(e){return r.setCurrent(e),r.stem(),r.getCurrent()}}(),Bravey.Language.IT.TimeEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["meno un quarto~"],val:-45*Bravey.Date.MINUTE},{str:["meno venti~"," meno 20"],val:-20*Bravey.Date.MINUTE},{str:["meno un quarto~"],val:-15*Bravey.Date.MINUTE},{str:["mezza~","trenta"],val:30*Bravey.Date.MINUTE},{str:["venti~"],val:30*Bravey.Date.MINUTE},{str:["un quarto~","quindici~","un quarto~"],val:15*Bravey.Date.MINUTE}],0),n=new Bravey.Text.RegexMap([{str:["di mattina~","del mattino~","am~","antimeridiane~"],val:0},{str:["di pomeriggio~","del pomeriggio~","di sera~","della sera~","pomeridiane~","pm~"],val:12*Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(per le\\b|l\\b|alle\\b|la\\b|le\\b)?"+Bravey.Text.WORDSEP+"(ore\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"(e\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+r.regex()+Bravey.Text.WORDSEP+"( minuti)?"+Bravey.Text.WORDSEP+n.regex()+"\\b","gi"),function(e){var t=1*e[3]*Bravey.Date.HOUR;if(e[4]&&e[5]&&(t+=1*e[5]*Bravey.Date.MINUTE),t+=r.get(e,6),t+=n.get(e,8),Bravey.Text.calculateScore(e,[1,2,5,6,7,8]))return Bravey.Date.formatTime(t)}),t.bindTo(this)},Bravey.Language.IT.TimePeriodEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["secondo~","secondi~"],val:Bravey.Date.SECOND},{str:["minuti~","minuto~"],val:Bravey.Date.MINUTE},{str:["ore~","ora~"],val:Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(entro\\b|tra\\b|in\\b)"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+r.regex(1),"gi"),function(e){var t,n,i=new Date;if(t=n=i.getHours()*Bravey.Date.HOUR+i.getMinutes()*Bravey.Date.MINUTE,n+=e[2]*r.get(e,3),Bravey.Text.calculateScore(e,[1,3]))return{start:Bravey.Date.formatTime(t),end:Bravey.Date.formatTime(n)}}),t.addMatch(new RegExp("\\b(di sera|della sera|in serata|nella serata|la sera|sera|stasera)\\b","gi"),function(e){return{start:"12:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(di pomeriggio|del pomeriggio|nel pomeriggio|il pomeriggio|pomeriggio)\\b","gi"),function(e){return{start:"15:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(di mattina|del mattino|in mattinata|della mattinata|la mattinata|mattina|stamattina)\\b","gi"),function(e){return{start:"08:00:00",end:"12:00:00"}}),t.bindTo(this)},Bravey.Language.IT.DateEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r="\\b(per il\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|il\\b|nel\\b|lo scorso\\b)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["gennaio~","gen~","1~","01~"],val:0},{str:["febbraio~","feb~","2~","02~"],val:1},{str:["marzo~","mar~","3~","03~"],val:2},{str:["aprile~","apr~","4~","04~"],val:3},{str:["maggio~","mag~","5~","05~"],val:4},{str:["giugno~","giu~","6~","06~"],val:5},{str:["luglio~","lug~","7~","07~"],val:6},{str:["agosto~","ago~","8~","08~"],val:7},{str:["settembre~","set~","sept~","9~","09~"],val:8},{str:["ottobre~","ott~","10~"],val:9},{str:["novembre~","nov~","11~"],val:10},{str:["dicembre~","dic~","12~"],val:11}],0);t.addMatch(new RegExp(r+"([0-9]{1,2})"+Bravey.Text.WORDSEP+"(di\\b|,\\b|/\\b|-\\b|\\b)"+Bravey.Text.WORDSEP+n.regex()+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|nel\\b|,\\b|/\\b|-\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=t.getDate();if(a=1*e[2],i=n.get(e,4,i),e[6]&&(r=1*e[6]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,4,6]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())},10),t.addMatch(new RegExp(r+n.regex(1)+Bravey.Text.WORDSEP+"([0-9]{1,2})?"+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|,\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=1;if(i=n.get(e,2,i),e[3]&&(a=1*e[3]),e[5]&&(r=1*e[5]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,3,4]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())},5),r="\\b(per\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|lo scorso\\b)?"+Bravey.Text.WORDSEP,t.addMatch(new RegExp(r+"(oggi)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),t.addMatch(new RegExp(r+"(domani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(dopodomani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(ieri)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(l'altro ieri|ieri l'altro)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-2*Bravey.Date.DAY)}),t.bindTo(this)},Bravey.Language.IT.FreeTextEntityRecognizer=function(e,t){var r=["grazie","per favore"],n=new Bravey.FreeTextEntityRecognizer(e,t);n.addConjunction("il"),n.addConjunction("lo"),n.addConjunction("la"),n.addConjunction("i"),n.addConjunction("gli"),n.addConjunction("le"),n.addConjunction("è"),n.addConjunction("é"),n.addConjunction("e"),n.addConjunction("ed"),n.addConjunction("e'"),n.addConjunction("sia"),n.addConjunction("mi pare"),n.addConjunction("dovrebbe essere"),n.addConjunction("sarebbe");for(var i=0;i<r.length;i++)n.addConjunction(r[i]),n.addConjunction(","+r[i]),n.addConjunction(", "+r[i]);return n},Bravey.Language.IT.Numbers=[{prefix:"zero",value:0},{prefix:"vent",value:20},{prefix:"trent",value:30},{prefix:"quarant",value:40},{prefix:"cinquant",value:50},{prefix:"sessant",value:60},{prefix:"settant",value:70},{prefix:"ottant",value:80},{prefix:"novant",value:90},{prefix:"uno",value:1},{prefix:"quattro",value:4},{prefix:"quattor",value:4},{prefix:"cinque",value:5},{prefix:"quin",value:5},{prefix:"sei",value:6},{prefix:"sette",value:7},{prefix:"otto",value:8},{prefix:"nove",value:9},{prefix:"dieci",value:10},{prefix:"dici",value:10},{prefix:"se",value:6},{prefix:"un",value:1},{prefix:"due",value:2},{prefix:"do",value:2},{prefix:"tre",value:3},{prefix:"a",skip:1},{prefix:"tor",skip:1},{prefix:"i",skip:1},{prefix:"n",skip:1},{prefix:"s",skip:1},{prefix:"cento",mul:100},{prefix:"mila",mul:1e3,end:1},{prefix:"mille",mul:1e3,end:1},{prefix:"milion",mul:1e6,end:1},{prefix:"miliard",mul:1e9,end:1},{prefix:"e",skip:1},{prefix:"i",skip:1},{prefix:"o",skip:1}],Bravey.Language.IT.NumberEntityRecognizer=function(e,t){var r=new RegExp("^[0-9]+$","gi"),n=new Bravey.RegexEntityRecognizer(e);return n.addMatch(new RegExp("(\\w+)","gi"),function(e){var t,n,i=e[0].toLowerCase(),a=0,s=0,o=9990,u=!1;if(i.match(r))return 1*i;do{t=!1;for(var c=0;c<Bravey.Language.IT.Numbers.length&&(n=Bravey.Language.IT.Numbers[c],i.substr(0,n.prefix.length)!=n.prefix||(i=i.substr(n.prefix.length),n.skip?t=!0:(o?n.end?(c<o&&(a+=s,s=0),o=c):(a+=s,s=0,o=0):n.end&&(o=c),void 0!==n.value&&(s+=n.value,t=!0,u=!0),void 0!==n.mul&&(s?s*=n.mul:s=n.mul,t=!0,u=!0)),!t));c++);}while(t);return a+=s,!i&&u?a:void 0}),n},Bravey.Language.EN={},Bravey.Language.EN.Stemmer=function(){var e=Bravey.stemmerSupport.Among,t=Bravey.stemmerSupport.SnowballProgram,r=new function(){function r(){var e,t=A.cursor;for(h=!1,A.bra=A.cursor,A.eq_s(1,"'")&&(A.ket=A.cursor,A.slice_del()),A.cursor=t,A.bra=t,A.eq_s(1,"y")&&(A.ket=A.cursor,A.slice_from("Y"),h=!0),A.cursor=t;;)if(e=A.cursor,A.in_grouping(I,97,121)&&(A.bra=A.cursor,A.eq_s(1,"y")))A.ket=A.cursor,A.cursor=e,A.slice_from("Y"),h=!0;else{if(e>=A.limit)return void(A.cursor=t);A.cursor=e+1}}function n(){var e=A.cursor;return p=A.limit,y=p,!A.find_among(x,3)&&(A.cursor=e,i())?void(A.cursor=e):(p=A.cursor,void(i()||(y=A.cursor)))}function i(){for(;!A.in_grouping(I,97,121);){if(A.cursor>=A.limit)return!0;A.cursor++}for(;!A.out_grouping(I,97,121);){if(A.cursor>=A.limit)return!0;A.cursor++}return!1}function a(){var e=A.limit-A.cursor;return!(!(A.out_grouping_b(N,89,121)&&A.in_grouping_b(I,97,121)&&A.out_grouping_b(I,97,121))&&(A.cursor=A.limit-e,!A.out_grouping_b(I,97,121)||!A.in_grouping_b(I,97,121)||A.cursor>A.limit_backward))}function s(){return p<=A.cursor}function o(){return y<=A.cursor}function u(){var e,t=A.limit-A.cursor;if(A.ket=A.cursor,e=A.find_among_b(_,3),e?(A.bra=A.cursor,1==e&&A.slice_del()):A.cursor=A.limit-t,A.ket=A.cursor,e=A.find_among_b(B,6))switch(A.bra=A.cursor,e){case 1:A.slice_from("ss");break;case 2:var r=A.cursor-2;if(A.limit_backward>r||r>A.limit){A.slice_from("ie");break}A.cursor=r,A.slice_from("i");break;case 3:do{if(A.cursor<=A.limit_backward)return;A.cursor--}while(!A.in_grouping_b(I,97,121));A.slice_del()}}function c(){var e,t,r,n;if(A.ket=A.cursor,e=A.find_among_b(T,6))switch(A.bra=A.cursor,e){case 1:s()&&A.slice_from("ee");break;case 2:for(t=A.limit-A.cursor;!A.in_grouping_b(I,97,121);){if(A.cursor<=A.limit_backward)return;A.cursor--}if(A.cursor=A.limit-t,
A.slice_del(),r=A.limit-A.cursor,e=A.find_among_b(D,13))switch(A.cursor=A.limit-r,e){case 1:var i=A.cursor;A.insert(A.cursor,A.cursor,"e"),A.cursor=i;break;case 2:A.ket=A.cursor,A.cursor>A.limit_backward&&(A.cursor--,A.bra=A.cursor,A.slice_del());break;case 3:if(A.cursor==p&&(n=A.limit-A.cursor,a())){A.cursor=A.limit-n;var i=A.cursor;A.insert(A.cursor,A.cursor,"e"),A.cursor=i}}}}function l(){var e=A.limit-A.cursor;A.ket=A.cursor,(A.eq_s_b(1,"y")||(A.cursor=A.limit-e,A.eq_s_b(1,"Y")))&&(A.bra=A.cursor,A.out_grouping_b(I,97,121)&&A.cursor>A.limit_backward&&A.slice_from("i"))}function f(){var e;if(A.ket=A.cursor,e=A.find_among_b(E,24),e&&(A.bra=A.cursor,s()))switch(e){case 1:A.slice_from("tion");break;case 2:A.slice_from("ence");break;case 3:A.slice_from("ance");break;case 4:A.slice_from("able");break;case 5:A.slice_from("ent");break;case 6:A.slice_from("ize");break;case 7:A.slice_from("ate");break;case 8:A.slice_from("al");break;case 9:A.slice_from("ful");break;case 10:A.slice_from("ous");break;case 11:A.slice_from("ive");break;case 12:A.slice_from("ble");break;case 13:A.eq_s_b(1,"l")&&A.slice_from("og");break;case 14:A.slice_from("ful");break;case 15:A.slice_from("less");break;case 16:A.in_grouping_b(z,99,116)&&A.slice_del()}}function g(){var e;if(A.ket=A.cursor,e=A.find_among_b(k,9),e&&(A.bra=A.cursor,s()))switch(e){case 1:A.slice_from("tion");break;case 2:A.slice_from("ate");break;case 3:A.slice_from("al");break;case 4:A.slice_from("ic");break;case 5:A.slice_del();break;case 6:o()&&A.slice_del()}}function v(){var e,t;if(A.ket=A.cursor,e=A.find_among_b(R,18),e&&(A.bra=A.cursor,o()))switch(e){case 1:A.slice_del();break;case 2:if(t=A.limit-A.cursor,!A.eq_s_b(1,"s")&&(A.cursor=A.limit-t,!A.eq_s_b(1,"t")))return;A.slice_del()}}function d(){var e,t;if(A.ket=A.cursor,e=A.find_among_b(S,2))switch(A.bra=A.cursor,e){case 1:if(t=A.limit-A.cursor,!o()){if(A.cursor=A.limit-t,!s()||a())return;A.cursor=A.limit-t}A.slice_del();break;case 2:if(!o()||!A.eq_s_b(1,"l"))return;A.slice_del()}}function b(){return A.ket=A.cursor,!!A.find_among_b(M,8)&&(A.bra=A.cursor,A.cursor<=A.limit_backward)}function m(){var e;if(A.bra=A.cursor,e=A.find_among(C,18),e&&(A.ket=A.cursor,A.cursor>=A.limit)){switch(e){case 1:A.slice_from("ski");break;case 2:A.slice_from("sky");break;case 3:A.slice_from("die");break;case 4:A.slice_from("lie");break;case 5:A.slice_from("tie");break;case 6:A.slice_from("idl");break;case 7:A.slice_from("gentl");break;case 8:A.slice_from("ugli");break;case 9:A.slice_from("earli");break;case 10:A.slice_from("onli");break;case 11:A.slice_from("singl")}return!0}return!1}function w(){var e;if(h)for(;;)if(e=A.cursor,A.bra=e,A.eq_s(1,"Y"))A.ket=A.cursor,A.cursor=e,A.slice_from("y");else{if(A.cursor=e,A.cursor>=A.limit)return;A.cursor++}}var h,y,p,x=[new e("arsen",-1,-1),new e("commun",-1,-1),new e("gener",-1,-1)],_=[new e("'",-1,1),new e("'s'",0,1),new e("'s",-1,1)],B=[new e("ied",-1,2),new e("s",-1,3),new e("ies",1,2),new e("sses",1,1),new e("ss",1,-1),new e("us",1,-1)],D=[new e("",-1,3),new e("bb",0,2),new e("dd",0,2),new e("ff",0,2),new e("gg",0,2),new e("bl",0,1),new e("mm",0,2),new e("nn",0,2),new e("pp",0,2),new e("rr",0,2),new e("at",0,1),new e("tt",0,2),new e("iz",0,1)],T=[new e("ed",-1,2),new e("eed",0,1),new e("ing",-1,2),new e("edly",-1,2),new e("eedly",3,1),new e("ingly",-1,2)],E=[new e("anci",-1,3),new e("enci",-1,2),new e("ogi",-1,13),new e("li",-1,16),new e("bli",3,12),new e("abli",4,4),new e("alli",3,8),new e("fulli",3,14),new e("lessli",3,15),new e("ousli",3,10),new e("entli",3,5),new e("aliti",-1,8),new e("biliti",-1,12),new e("iviti",-1,11),new e("tional",-1,1),new e("ational",14,7),new e("alism",-1,8),new e("ation",-1,7),new e("ization",17,6),new e("izer",-1,6),new e("ator",-1,7),new e("iveness",-1,11),new e("fulness",-1,9),new e("ousness",-1,10)],k=[new e("icate",-1,4),new e("ative",-1,6),new e("alize",-1,3),new e("iciti",-1,4),new e("ical",-1,4),new e("tional",-1,1),new e("ational",5,2),new e("ful",-1,5),new e("ness",-1,5)],R=[new e("ic",-1,1),new e("ance",-1,1),new e("ence",-1,1),new e("able",-1,1),new e("ible",-1,1),new e("ate",-1,1),new e("ive",-1,1),new e("ize",-1,1),new e("iti",-1,1),new e("al",-1,1),new e("ism",-1,1),new e("ion",-1,2),new e("er",-1,1),new e("ous",-1,1),new e("ant",-1,1),new e("ent",-1,1),new e("ment",15,1),new e("ement",16,1)],S=[new e("e",-1,1),new e("l",-1,2)],M=[new e("succeed",-1,-1),new e("proceed",-1,-1),new e("exceed",-1,-1),new e("canning",-1,-1),new e("inning",-1,-1),new e("earring",-1,-1),new e("herring",-1,-1),new e("outing",-1,-1)],C=[new e("andes",-1,-1),new e("atlas",-1,-1),new e("bias",-1,-1),new e("cosmos",-1,-1),new e("dying",-1,3),new e("early",-1,9),new e("gently",-1,7),new e("howe",-1,-1),new e("idly",-1,6),new e("lying",-1,4),new e("news",-1,-1),new e("only",-1,10),new e("singly",-1,11),new e("skies",-1,2),new e("skis",-1,1),new e("sky",-1,-1),new e("tying",-1,5),new e("ugly",-1,8)],I=[17,65,16,1],N=[1,17,65,208,1],z=[55,141,2],O=[c,l,f,g,v,d],A=new t;this.setCurrent=function(e){A.setCurrent(e)},this.getCurrent=function(){return A.getCurrent()},this.stem=function(){var e=A.cursor;if(!m()){A.cursor=e;var t=A.cursor+3;if(0<=t&&t<=A.limit){if(A.cursor=e,r(),A.cursor=e,n(),A.limit_backward=e,A.cursor=A.limit,u(),A.cursor=A.limit,!b())for(var i=0;i<O.length;i++)A.cursor=A.limit,O[i]();A.cursor=A.limit_backward,w()}}return!0}};return function(e){return r.setCurrent(e),r.stem(),r.getCurrent()}}(),Bravey.Language.EN.TimeEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["quarter to~"],val:-15*Bravey.Date.MINUTE},{str:["half past~"],val:30*Bravey.Date.MINUTE},{str:["quarter past~"],val:15*Bravey.Date.MINUTE}],0),n=new Bravey.Text.RegexMap([{str:["in the morning~","am~"],val:0},{str:["in the afternoon~","in the evening~","pm~"],val:12*Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(at\\b)?"+Bravey.Text.WORDSEP+r.regex()+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"(and\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+"(minutes\\b)?"+Bravey.Text.WORDSEP+"(o'clock\\b)?"+Bravey.Text.WORDSEP+n.regex(),"gi"),function(e){var t=1*e[3]*Bravey.Date.HOUR;if(e[5]&&(t+=1*e[5]*Bravey.Date.MINUTE),t+=r.get(e,2),t+=n.get(e,8),Bravey.Text.calculateScore(e,[1,2,4,5,6,7,8]))return Bravey.Date.formatTime(t)}),t.bindTo(this)},Bravey.Language.EN.TimePeriodEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r=new Bravey.Text.RegexMap([{str:["second","seconds"],val:Bravey.Date.SECOND},{str:["minute","minutes"],val:Bravey.Date.MINUTE},{str:["hour","hours"],val:Bravey.Date.HOUR}],0);t.addMatch(new RegExp("\\b(in\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+r.regex(1)+"\\b","gi"),function(e){var t,n,i=new Date;if(n=t=i.getHours()*Bravey.Date.HOUR+i.getMinutes()*Bravey.Date.MINUTE,t+=e[2]*r.get(e,3),Bravey.Text.calculateScore(e,[1,3]))return{start:Bravey.Date.formatTime(n),end:Bravey.Date.formatTime(t)}}),t.addMatch(new RegExp("\\b(in the evening|this evening|evening)\\b","gi"),function(e){return{start:"12:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(in the afternoon|this afternoon|afternoon)\\b","gi"),function(e){return{start:"15:00:00",end:"23:59:00"}}),t.addMatch(new RegExp("\\b(in the morning|this morning|morning)\\b","gi"),function(e){return{start:"08:00:00",end:"12:00:00"}}),t.bindTo(this)},Bravey.Language.EN.DateEntityRecognizer=function(e){var t=new Bravey.RegexEntityRecognizer(e),r="\\b(day of|last\\b)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["january~","jan~","1~","01~"],val:0},{str:["february~","feb~","2~","02~"],val:1},{str:["march~","mar~","3~","03~"],val:2},{str:["april~","apr~","4~","04~"],val:3},{str:["may~","may~","5~","05~"],val:4},{str:["june~","june~","6~","06~"],val:5},{str:["july~","july~","7~","07~"],val:6},{str:["august~","aug~","8~","08~"],val:7},{str:["september~","sep~","sept~","9~","09~"],val:8},{str:["october~","oct~","10~"],val:9},{str:["november~","nov~","11~"],val:10},{str:["december~","dec~","12~"],val:11}],0);t.addMatch(new RegExp(r+n.regex(1)+Bravey.Text.WORDSEP+"([0-9]{1,2})?"+Bravey.Text.WORDSEP+"(st\\b|nd\\b|rd\\b|th\\b)?"+Bravey.Text.WORDSEP+"(of\\b|,\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=1;if(i=n.get(e,2,i),e[3]&&(a=1*e[3]),e[6]&&(r=1*e[6]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,3,6]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())}),t.addMatch(new RegExp(r+"([0-9]{1,2})"+Bravey.Text.WORDSEP+"(st\\b|nd\\b|rd\\b|th\\b)?"+Bravey.Text.WORDSEP+"(of\\b|,\\b|/\\b|-\\b|\\b)"+Bravey.Text.WORDSEP+n.regex()+"(of\\b|,\\b|/\\b|-\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var t=new Date,r=t.getFullYear(),i=t.getMonth(),a=t.getDate();if(a=1*e[2],i=n.get(e,5,i),e[7]&&(r=1*e[7]),r=Bravey.Date.centuryFinder(r),Bravey.Text.calculateScore(e,[1,5,7]))return Bravey.Date.formatDate(new Date(r,i,a,0,0,0,0).getTime())},10),t.addMatch(new RegExp(r+"(today)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),t.addMatch(new RegExp(r+"(tomorrow)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(the day after tomorrow)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),t.addMatch(new RegExp(r+"(yesterday)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),t.bindTo(this)},Bravey.Language.EN.FreeTextEntityRecognizer=function(e,t){var r=["thanks","please"],n=new Bravey.FreeTextEntityRecognizer(e,t);n.addConjunction("is"),n.addConjunction("are"),n.addConjunction("should be"),n.addConjunction("may be");for(var i=0;i<r.length;i++)n.addConjunction(r[i]),n.addConjunction(","+r[i]),n.addConjunction(", "+r[i]);return n},Bravey.Language.EN.Numbers={wordsSeparator:/(\w+)([^\w]+)/gi,sum:{zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},mul:{thousand:1e3,million:1e6}},Bravey.Language.EN.NumberEntityRecognizer=function(e,t){this.getName=function(){return e},this.getEntities=function(r,n){n||(n=[]);for(var i,a,s,o,u,c,l=r.toLowerCase().split(/(\w+)/),f=0,g=0,v=0,d=0;d<l.length+1;d++)a=void 0==l[d]?"*":l[d],s=!0,o||(u=0,o={value:0,entity:e,string:"",priority:t||0}),a.trim()&&(null!=Bravey.Language.EN.Numbers.sum[a]?g+=Bravey.Language.EN.Numbers.sum[a]:"hundred"==a?g*=100:isNaN(1*a)?Bravey.Language.EN.Numbers.mul[a]?(i=Bravey.Language.EN.Numbers.mul[a],f+=g*i,g=0):s=!1:u?(d--,a="",s=!1):f=1*a,s?(u=1,c=v+a.length,void 0==o.position&&(o.position=v)):u&&(o.value=f+g,o.string=r.substr(o.position,c-o.position),n.push(o),f=g=o=0)),v+=a.length;return n}},Bravey.Nlp.Fuzzy=function(e,t){function r(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}function n(e,t){for(var n=[],i={},a=0;a<t.length;a++)i[t[a].entity]||(i[t[a].entity]=1,l[t[a].entity].getEntities(e,n));return r(n),n}function i(e,t){for(var r,i,a,s=n(e,t.entities),o=[],u={},c=[],l=-1,f="",g=!1,v=!1,d=!1,b={},m=0,w=0;w<s.length;w++)if(r=s[w].entity,s[w].position>=l)if(t.index[r])if(void 0==b[r]&&(b[r]=0),i=t.index[r][b[r]]){b[r]++,m++;var h={position:s[w].position,entity:r,value:s[w].value,string:s[w].string,id:i};o.push(h),u[h.id]=h,a=l==-1?e.substr(0,s[w].position):e.substr(l,s[w].position-l),a.length&&c.push({string:a}),c.push(h),f+=a,f+="{"+r+"}",l=s[w].position+s[w].string.length}else g=!0;else v=!0;return a=e.substr(l==-1?0:l),a.length&&(a.length&&c.push({string:a}),f+=a),{found:m,missingEntities:d,exceedEntities:g,extraEntities:v,text:f,entities:o,sentence:c,entitiesIndex:u}}function a(e,t,r){for(var i,a,s="",o=-1,u=-1,c=n(e,f),l={},g=0;g<c.length;g++)i=c[g].entity,c[g].position>u&&(o++,t.index[i]||(t.index[i]=[]),void 0==l[i]?l[i]=0:l[i]++,a=t.index[i][l[i]],a||(a=t.index[i][l[i]]=r&&r[o]?r[o]:i+(l[i]?l[i]:""),t.entities.push({entity:i,id:a}),console.warn("Adding entity",a,"to",t.name)),s+=u==-1?e.substr(0,c[g].position):e.substr(u,c[g].position-u),s+="{"+i+"}",u=c[g].position+c[g].string.length);return s+=e.substr(u==-1?0:u),{text:s}}function s(e,t,r){var n,i=-1,a={};return e.replace(/\{([.a-z_-]+)\}/g,function(e,s){i++,t.index[s]||(t.index[s]=[]),void 0==a[s]?a[s]=0:a[s]++,n=t.index[s][a[s]],n||(n=t.index[s][a[s]]=r&&r[i]?r[i]:s+(a[s]?a[s]:""),t.entities.push({entity:s,id:n}),console.warn("Adding entity",n,"to",t.name))}),{text:e}}function o(e){for(var t,r,i,a=[],s={},o=[],u="",c={},l=-1,g=-1,v=0,d=n(e,f),b=0;b<d.length;b++)if(r=d[b].entity,d[b].position>l){v++,g++,void 0==c[r]?c[r]=0:c[r]++,i=r+(c[r]?c[r]:"");var m={position:d[b].position,entity:r,value:d[b].value,string:d[b].string,id:i};a.push(m),s[m.id]=m,t=l==-1?e.substr(0,d[b].position):e.substr(l,d[b].position-l),t.length&&o.push({string:t}),o.push(m),u+=t,u+="{"+r+"}",l=d[b].position+d[b].string.length}return t=e.substr(l==-1?0:l),t.length&&(t.length&&o.push({string:t}),u+=t),{found:v,text:u,entities:a,sentence:o,entitiesIndex:s}}t=t||{};var u={},c=new Bravey.DocumentClassifier(t),l={},f=[],g=.75;this.addIntent=function(e,t){for(var r={},n=0;n<t.length;n++)r[t[n].entity]||(r[t[n].entity]=[]),r[t[n].entity].push(t[n].id);return u[e]={name:e,entities:t,index:r},!0},this.addEntity=function(e){var t=e.getName();return l[t]||f.push({entity:t,id:"none"}),l[t]=e,!0},this.hasEntity=function(e){return!!l[e]},this.setConfidence=function(e){g=e},this.getConfidence=function(e){return g},this.addDocument=function(e,t,r){if(r){if(r.fromFullSentence){if(e=Bravey.Text.clean(e),r.expandIntent){u[t]||(console.warn("Adding intent",t),this.addIntent(t,[]));var n=a(e,u[t],r.withNames);return c.addDocument(n.text,t)}}else if(r.fromTaggedSentence&&r.expandIntent){u[t]||(console.warn("Adding intent",t),this.addIntent(t,[]));var n=s(e,u[t],r.withNames);return c.addDocument(n.text,t)}return console.warn("Can't guess..."),!1}return u[t]?c.addDocument(Bravey.Text.clean(e),t):(console.warn("Can't find intent",t),!1)},this.test=function(e,t){switch(e=Bravey.Text.clean(e),t){case"anyEntity":var r=o(e),n=c.classifyDocument(r.text);return r.score=n.winner.score,r.intent=n.winner.label,r;default:var n,a,r=!1,s=-1,l=-1;for(var f in u)a=i(e,u[f]),a.exceedEntities||a.extraEntities||a.missingEntities||(n=c.classifyDocument(a.text),n.scores[f]>g&&(n.scores[f]>s||n.scores[f]==s&&a.found>l)&&(r=a,r.score=s=n.scores[f],l=r.found,r.intent=f));return r}return!1}},Bravey.Nlp.Sequential=function(e,t){function r(e){return e.split(/~/)[0]}function n(e){e.sort(function(e,t){return e.position<t.position?-1:e.position>t.position?1:e.string.length>t.string.length?-1:e.string.length<t.string.length?1:e.priority>t.priority?-1:e.priority<t.priority?1:0})}function i(e,t){for(var r=[],i={},a=0;a<t.length;a++)i[t[a].entity]||(i[t[a].entity]=1,l[t[a].entity].getEntities(e,r));return n(r),r}function a(e,t,r){for(var n=t||"",a="",s=[],o={},u=0,c=-1,l=i(e,f),g=0;g<l.length;g++)ent=l[g].entity,l[g].position>=c&&(n+="~"+ent,void 0==o[ent]?o[ent]=0:o[ent]++,nextid=r&&r[u]?r[u]:ent+(o[ent]?o[ent]:""),s.push({entity:ent,id:nextid}),a+=c==-1?e.substr(0,l[g].position):e.substr(c,l[g].position-c),a+="{"+ent+"}",c=l[g].position+l[g].string.length,u++);return a+=e.substr(c==-1?0:c),{error:!1,text:a,name:n,entities:s}}function s(e,t,r){var n,i=-1,a={},s=t||"",o=[],a={},i=0,u=!1;return e.replace(/\{([.a-z_-]+)\}/g,function(e,t){l[t]?(s+="~"+t,void 0==a[t]?a[t]=0:a[t]++,n=r&&r[i]?r[i]:t+(a[t]?a[t]:""),o.push({entity:t,id:n}),i++):u=t}),{error:u,text:e,name:s,entities:o}}function o(e,t){function r(){for(;t.entities[f]&&l[t.entities[f].entity].expand;){var r={position:c<0?0:c,entity:t.entities[f].entity,value:"",string:e.substr(c<0?0:c),id:t.entities[f].id};o[r.id]=r,s.push(r),f++}}var n,a=i(e,t.entities),s=[],o={},u=!1,c=-1,f=0;if(r(),a.length){for(var g=0;g<a.length;g++)if(n=a[g].entity,a[g].position>=c&&t.entities[f].entity==n){var v={position:a[g].position,entity:n,value:a[g].value,string:a[g].string,id:t.entities[f].id};if(s.push(v),o[v.id]=v,c=a[g].position+a[g].string.length,f++,r(),f>=t.entities.length)break}}else u=t.entities.length;for(var d,b,m="",w="",c=0,h=[],g=0;g<s.length;g++)l[s[g].entity].expand&&(d=s[g+1],d&&(s[g].string=s[g].string.substr(0,d.position-s[g].position)),b=s[g].position,l[s[g].entity].expand(s[g]),l[s[g].entity].position>b&&(w=e.substr(c,l[s[g].entity].position-b),h.push({string:w}),m+=w,c+=l[s[g].entity].position-b)),w=e.substr(c,s[g].position-c),w&&(h.push({string:w}),m+=w),h.push(s[g]),m+="{"+s[g].entity+"}",c=s[g].position+s[g].string.length;return(w=e.substr(c))&&(h.push({string:w}),m+=w),{found:s.length,exceedEntities:!1,missingEntities:s.length<t.entities.length,extraEntities:s.length>t.entities.length,text:m,entities:s,sentence:h,entitiesIndex:o}}t=t||{};var u={},c=new Bravey.DocumentClassifier(t),l={},f=[],g=.75;this.addIntent=function(e,t){for(var r={},n=e,i=0;i<t.length;i++)n+="~"+t[i].entity,r[t[i].entity]||(r[t[i].entity]=[]),r[t[i].entity].push(t[i].id);return u[n]={name:n,root:e,entities:t,index:r},!0},this.addEntity=function(e){var t=e.getName();return l[t]||f.push({entity:t,id:"none"}),l[t]=e,!0},this.hasEntity=function(e){return!!l[e]},this.setConfidence=function(e){g=e},this.getConfidence=function(e){return g},this.addDocument=function(e,t,n){if(n){if(n.fromFullSentence){if(e=Bravey.Text.clean(e),n.expandIntent){var i=a(e,t,n.withNames);return u[i.name]||(console.warn("Adding intent",i.name),this.addIntent(t,i.entities)),c.addDocument(i.text,t)}}else if(n.fromTaggedSentence){var i=s(e,t,n.withNames);return i.error!==!1?(console.warn("Can't find entity typed",i.error),!1):(u[i.name]||(console.warn("Adding intent",i.name),this.addIntent(t,i.entities)),c.addDocument(i.text,t))}return console.warn("Can't guess..."),!1}return u[t]?c.addDocument(Bravey.Text.clean(e),r(t)):(console.warn("Can't find intent",t),!1)},this.test=function(e,t){switch(e=Bravey.Text.clean(e),t){default:var r,n,i,a=!1,s=-1,l=-1;for(var f in u)i=o(e,u[f]),i.exceedEntities||i.extraEntities||i.missingEntities||(n=c.classifyDocument(i.text),r=n.scores[u[f].root],r>g&&(r>s||i.found>l)&&(a=i,a.score=s=r,l=a.found,a.intent=u[f].root));return a}return!1}},Bravey.ApiAiAdapter=function(e,t){function r(e){return e.replace(/[^a-z0-9:]/g,"_")}function n(){Bravey.File.load(a[f],function(e){s[a[f]]=e,f++,a[f]?n():i()})}function i(){for(var e,t={},n=0;n<u.length;n++){for(var i=JSON.parse(s[u[n].file]),a=new Bravey.StringEntityRecognizer(u[n].name),f=0;f<i.entries.length;f++)for(var g=0;g<i.entries[f].synonyms.length;g++)a.addMatch(i.entries[f].value,i.entries[f].synonyms[g]);c.addEntity(a)}for(var n=0;n<o.length;n++)for(var i=JSON.parse(s[o[n].file]),f=0;f<i.userSays.length;f++){for(var v="",d=!1,g=0;g<i.userSays[f].data.length;g++)i.userSays[f].data[g].meta?(e=i.userSays[f].data[g].meta.substr(1),v+="{"+e+":"+i.userSays[f].data[g].alias+"}"):v+=i.userSays[f].data[g].text.replace(/\@([.a-z0-9_-]+):([.a-z0-9_-]+)/g,"{$1:$2}");var b=[];v=v.replace(/\{([.a-z0-9_-]+):([.a-z0-9_-]+)\}/g,function(e,n,a){return n=r(n),a=r(a),c.hasEntity(n)||(d=!0,t[n]||(console.warn("Missing entity",n,i.userSays[f].data),t[n]=1)),b.push(a),"{"+n+"}"}),d||c.addDocument(v.trim(),o[n].name,{fromTaggedSentence:!0,expandIntent:!0,withNames:b})}l()}t=t||{};var a=[],s={},o=[],u=[],c=new Bravey.Nlp[t.nlp||"Fuzzy"]("apiai",{stemmer:Bravey.Language[t.language].Stemmer,filter:t.filter});c.addEntity(new Bravey.Language[t.language].NumberEntityRecognizer("sys_number")),c.addEntity(new Bravey.Language[t.language].TimeEntityRecognizer("sys_time")),c.addEntity(new Bravey.Language[t.language].DateEntityRecognizer("sys_date")),c.addEntity(new Bravey.Language[t.language].TimePeriodEntityRecognizer("sys_time_period"));var l,f=0;this.loadIntent=function(t){var r=e+"/intents/"+t+".json";a.push(r),o.push({file:r,name:t})},this.loadEntity=function(t){var r=e+"/entities/"+t+".json";a.push(r),u.push({file:r,name:t})},this.prepare=function(e){l=e,n()},this.test=function(e,t){var r=this.nlp.test(e,t);if(r){var n={result:{source:"agent",resolvedQuery:e,action:"",actionIncomplete:!1,parameters:{},contexts:[],metadata:{intentName:""},fulfillment:{speech:""},score:0},status:{code:200,errorType:"success"}};n.result.metadata.intentName=r.intent,n.result.score=r.score;for(var i in r.entitiesIndex)n.result.parameters[i]=r.entitiesIndex[i].value;return n}return{result:{resolvedQuery:e,contexts:[],metadata:{},fulfillment:{speech:""},score:0},status:{code:200,errorType:"success"}}},this.nlp=c},Bravey.ContextManager=function(e){e=e||{};var t=["default"],r={},n={},i=e.sessionManager||new Bravey.SessionManager.InMemorySessionManager(e);this.addNlp=function(e,i,a){i||(i=t);for(var s=0;s<i.length;s++)r[i[s]]||(r[i[s]]=[],n[i[s]]=[]),r[i[s]].indexOf(e)==-1&&(r[i[s]].push(e),n[i[s]].push({method:a}))},this.removeNlp=function(e,t){var i;if(t)for(var a=0;a<t.length;a++)(i=r[t[a]].indexOf(e))!=-1&&(r[t[a]].splice(i,1),n[t[a]].splice(i,1));else for(var a in r)(i=r[a].indexOf(e))!=-1&&(r[a].splice(i,1),n[a].splice(i,1))},this.removeContext=function(e){r[e]&&delete r[e]},this.setSessionIdContext=function(e,t){return i.setContext(e,t)},this.setSessionIdData=function(e,t){return i.setData(e,t)},this.clearSessionIdData=function(e){return i.clearData(e)},this.getSessionIdData=function(e){return i.getData(e)},this.reserveSessionId=function(e){return i.reserveSessionId(e)},this.testByContext=function(e,i){var a,s={result:!1};i||(i=t);for(var o=0;o<i.length;o++)if(r[i[o]])for(var u=0;u<r[i[o]].length;u++)a=r[i[o]][u].test(e,n[i[o]][u].method),(!s.result||a.score&&a.score>s.result.score||a.score==s.result.score||a.found>s.result.found)&&(s.result=a,s.context=i[o]);return s},this.testBySessionId=function(e,t){var r,n={result:!1};if(r=void 0===t?t=i.reserveSessionId():i.keepAlive(t)){var a=i.getContext(t);n=this.testByContext(e,a),n.sessionId=t,n.sessionContext=a,n.sessionData=i.getData(t)}return n}},Bravey.SessionManager.InMemorySessionManager=function(e){function t(){return(new Date).getTime()}function r(){var e=t();for(var r in i)e-i[r].timestamp>a&&delete i[r]}function n(){return{context:["default"],data:{},timestamp:t()}}e||(e={});var i={},a=e.sessionLength||6e5;this.reserveSessionId=function(e){if(void 0==e)do e=Bravey.Text.generateGUID();while(i[e]);return r(),i[e]||(i[e]=n()),e},this.keepAlive=function(e){return!!i[e]&&(i[e].timestamp=t(),!0)},this.setContext=function(e,t){return!!i[e]&&(i[e].context=t,this.keepAlive(e),!0)},this.setData=function(e,t){if(i[e]){for(var r in t)i[e].data[r]=t[r];return this.keepAlive(e),!0}return!1},this.clearData=function(e,t){return!!i[e]&&(i[e].data={},this.keepAlive(e),!0)},this.getContext=function(e){if(i[e])return i[e].context},this.getData=function(e){if(i[e])return i[e].data}},Bravey.Filter.BasicFilter=function(e){for(var t=[],r=0;r<e.length;r++)"{"!=e[r][0]&&e[r].length>3&&t.push(e[r]);return t.length<3?e:t};