// Bravey v0.1 - http://github.com/braveyjs/bravey - MIT Licensed
var Bravey={REVISION:"0.1"};"function"==typeof define&&define.amd?define("Bravey",Bravey):"undefined"!=typeof exports&&"undefined"!=typeof module&&(module.exports=Bravey),Bravey.DATA={},Bravey.Language={},Bravey.Nlp={},Bravey.Filter={},Bravey.SessionManager={},Bravey.File={},Bravey.File.load=function(e,r,t,n){if("undefined"!=typeof module&&module.exports)Bravey.DATA.fs||(Bravey.DATA.fs=require("fs")),r(Bravey.DATA.fs.readFileSync(e,"utf8"));else{var i=null;i=new XMLHttpRequest,i.onreadystatechange=function(){4==i.readyState&&(200==i.status?r(i.responseText):r())},i.open(t||"GET",e),i.send(null)}},Bravey.Text={},Bravey.Text.WORDSEP="[^(a-zA-ZA-Яa-я0-9_!?.:)+s]*",Bravey.Text.TRIMSTART=new RegExp("^("+Bravey.Text.WORDSEP+")","gi"),Bravey.Text.TRIMEND=new RegExp("("+Bravey.Text.WORDSEP+")$","gi"),Bravey.Text.generateGUID=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},Bravey.Text.calculateScore=function(e,r){for(var t=0,n=0;n<r.length;n++)e[r[n]]&&t++;return t},Bravey.Text.entityTrim=function(e){var r=e.string.match(Bravey.Text.TRIMSTART),t=e.string.match(Bravey.Text.TRIMEND),n=r?r[0].length:0,i=t?t[0].length:0;return e.position+=n,e.string=e.string.substr(n,e.string.length-n-i),e},Bravey.Text.RegexMap=function(e,r){for(var t=0;t<e.length;t++){e[t].mtch=[];for(var n=0;n<e[t].str.length;n++)e[t].mtch.push(e[t].str[n].replace(/~/g,""))}this.regex=function(r){for(var t="(",n=0;n<e.length;n++)for(var i=0;i<e[n].str.length;i++)t+=e[n].str[i].replace(/~/g,"\\b")+"|";return t.substr(0,t.length-1)+")"+(r?"":"?")},this.get=function(t,n,i){for(var a=0;a<e.length;a++)for(var s=0;s<e[a].mtch.length;s++)if(t[n]==e[a].mtch[s])return e[a].val;return void 0==i?r:i}},Bravey.Text.unique=function(e){for(var r={},t=[],n=0,i=e.length;n<i;++n)r.hasOwnProperty(e[n])||(t.push(e[n]),r[e[n]]=1);return t},Bravey.Text.clean=function(e){return Bravey.Text.removeDiacritics(e).toLowerCase().trim().replace(/ +(?= )/g,"").replace(/[()\[\]]/g,"")},Bravey.Text.pad=function(e,r,t){return t=t||"0",e+="",e.length>=r?e:new Array(r-e.length+1).join(t)+e},Bravey.Text.tokenize=function(e){var r=e.replace(/[^(a-zA-ZA-Яa-я0-9_)+\s]/g," ").trim().replace(/ +(?= )/g,"");return Bravey.Text.unique(r.split(/\s+/))},Bravey.DATA.diacriticsMap={},Bravey.Text.removeDiacritics=function(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return Bravey.DATA.diacriticsMap[e]||e})},function(){defaultDiacriticsRemovalap=[{base:" ",letters:" "},{base:"0",letters:"߀"},{base:"A",letters:"ⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄȺⱯ"},{base:"AA",letters:"Ꜳ"},{base:"AE",letters:"ÆǼǢ"},{base:"AO",letters:"Ꜵ"},{base:"AU",letters:"Ꜷ"},{base:"AV",letters:"ꜸꜺ"},{base:"AY",letters:"Ꜽ"},{base:"B",letters:"ⒷＢḂḄḆɃƁ"},{base:"C",letters:"ⒸＣꜾḈĆCĈĊČÇƇȻ"},{base:"D",letters:"ⒹＤḊĎḌḐḒḎĐƊƉᴅꝹ"},{base:"Dh",letters:"Ð"},{base:"DZ",letters:"ǱǄ"},{base:"Dz",letters:"ǲǅ"},{base:"E",letters:"ɛⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎᴇ"},{base:"F",letters:"ꝼⒻＦḞƑꝻ"},{base:"G",letters:"ⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾɢ"},{base:"H",letters:"ⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ"},{base:"I",letters:"ⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ"},{base:"J",letters:"ⒿＪĴɈȷ"},{base:"K",letters:"ⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ"},{base:"L",letters:"ⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ"},{base:"LJ",letters:"Ǉ"},{base:"Lj",letters:"ǈ"},{base:"M",letters:"ⓂＭḾṀṂⱮƜϻ"},{base:"N",letters:"ꞤȠⓃＮǸŃÑṄŇṆŅṊṈƝꞐᴎ"},{base:"NJ",letters:"Ǌ"},{base:"Nj",letters:"ǋ"},{base:"O",letters:"ⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ"},{base:"OE",letters:"Œ"},{base:"OI",letters:"Ƣ"},{base:"OO",letters:"Ꝏ"},{base:"OU",letters:"Ȣ"},{base:"P",letters:"ⓅＰṔṖƤⱣꝐꝒꝔ"},{base:"Q",letters:"ⓆＱꝖꝘɊ"},{base:"R",letters:"ⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ"},{base:"S",letters:"ⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ"},{base:"T",letters:"ⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ"},{base:"Th",letters:"Þ"},{base:"TZ",letters:"Ꜩ"},{base:"U",letters:"ⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ"},{base:"V",letters:"ⓋＶṼṾƲꝞɅ"},{base:"VY",letters:"Ꝡ"},{base:"W",letters:"ⓌＷẀẂŴẆẄẈⱲ"},{base:"X",letters:"ⓍＸẊẌ"},{base:"Y",letters:"ⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ"},{base:"Z",letters:"ⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ"},{base:"a",letters:"ⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐɑ"},{base:"aa",letters:"ꜳ"},{base:"ae",letters:"æǽǣ"},{base:"ao",letters:"ꜵ"},{base:"au",letters:"ꜷ"},{base:"av",letters:"ꜹꜻ"},{base:"ay",letters:"ꜽ"},{base:"b",letters:"ⓑｂḃḅḇƀƃɓƂ"},{base:"c",letters:"ｃⓒćĉċčçḉƈȼꜿↄ"},{base:"d",letters:"ⓓｄḋďḍḑḓḏđƌɖɗƋᏧԁꞪ"},{base:"dh",letters:"ð"},{base:"dz",letters:"ǳǆ"},{base:"e",letters:"ⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇǝ"},{base:"f",letters:"ⓕｆḟƒ"},{base:"ff",letters:"ﬀ"},{base:"fi",letters:"ﬁ"},{base:"fl",letters:"ﬂ"},{base:"ffi",letters:"ﬃ"},{base:"ffl",letters:"ﬄ"},{base:"g",letters:"ⓖｇǵĝḡğġǧģǥɠꞡꝿᵹ"},{base:"h",letters:"ⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ"},{base:"hv",letters:"ƕ"},{base:"i",letters:"ⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı"},{base:"j",letters:"ⓙｊĵǰɉ"},{base:"k",letters:"ⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ"},{base:"l",letters:"ⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇɭ"},{base:"lj",letters:"ǉ"},{base:"m",letters:"ⓜｍḿṁṃɱɯ"},{base:"n",letters:"ⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥлԉ"},{base:"nj",letters:"ǌ"},{base:"o",letters:"ⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿꝋꝍɵɔᴑ"},{base:"oe",letters:"œ"},{base:"oi",letters:"ƣ"},{base:"oo",letters:"ꝏ"},{base:"ou",letters:"ȣ"},{base:"p",letters:"ⓟｐṕṗƥᵽꝑꝓꝕρ"},{base:"q",letters:"ⓠｑɋꝗꝙ"},{base:"r",letters:"ⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ"},{base:"s",letters:"ⓢｓśṥŝṡšṧṣṩșşȿꞩꞅẛʂ"},{base:"ss",letters:"ß"},{base:"t",letters:"ⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ"},{base:"th",letters:"þ"},{base:"tz",letters:"ꜩ"},{base:"u",letters:"ⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ"},{base:"v",letters:"ⓥｖṽṿʋꝟʌ"},{base:"vy",letters:"ꝡ"},{base:"w",letters:"ⓦｗẁẃŵẇẅẘẉⱳ"},{base:"x",letters:"ⓧｘẋẍ"},{base:"y",letters:"ⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ"},{base:"z",letters:"ⓩｚźẑżžẓẕƶȥɀⱬꝣ"}];for(var e=0;e<defaultDiacriticsRemovalap.length;e++)for(var r=defaultDiacriticsRemovalap[e].letters,t=0;t<r.length;t++)Bravey.DATA.diacriticsMap[r[t]]=defaultDiacriticsRemovalap[e].base}(),Bravey.Date={},Bravey.Date.SECOND=1e3,Bravey.Date.MINUTE=60*Bravey.Date.SECOND,Bravey.Date.HOUR=60*Bravey.Date.MINUTE,Bravey.Date.DAY=24*Bravey.Date.HOUR,Bravey.Date.formatDate=function(e){var r=new Date(e);return Bravey.Text.pad(r.getFullYear(),4)+"-"+Bravey.Text.pad(r.getMonth()+1,2)+"-"+Bravey.Text.pad(r.getDate(),2)},Bravey.Date.formatTime=function(e){return Bravey.Text.pad(Math.floor(e/Bravey.Date.HOUR),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.HOUR/Bravey.Date.MINUTE),2)+":"+Bravey.Text.pad(Math.floor(e%Bravey.Date.MINUTE/Bravey.Date.SECOND),2)},Bravey.Date.centuryFinder=function(e){return e<100?e>20?e+1900:e+2e3:e},Bravey.Data={},Bravey.Data.getEntityValue=function(e,r,t){var n;return e&&(void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[r]&&(n=e.result.entitiesIndex[r].value),n==t&&(n=void 0),void 0==n&&void 0!==e.sessionData&&(n=e.sessionData[r])),n},Bravey.Data.isExplicit=function(e,r){return e&&void 0!==e.result&&void 0!==e.result.entitiesIndex&&void 0!==e.result.entitiesIndex[r]},Bravey.stemmerSupport={Among:function(e,r,t,n){if(this.toCharArray=function(e){for(var r=e.length,t=new Array(r),n=0;n<r;n++)t[n]=e.charCodeAt(n);return t},!e&&""!=e||!r&&0!=r||!t)throw"Bad Among initialisation: s:"+e+", substring_i: "+r+", result: "+t;this.s_size=e.length,this.s=this.toCharArray(e),this.substring_i=r,this.result=t,this.method=n},SnowballProgram:function(){var e;return{bra:0,ket:0,limit:0,cursor:0,limit_backward:0,setCurrent:function(r){e=r,this.cursor=0,this.limit=r.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit},getCurrent:function(){var r=e;return e=null,r},in_grouping:function(r,t,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i<=n&&i>=t&&(i-=t,r[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},in_grouping_b:function(r,t,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i<=n&&i>=t&&(i-=t,r[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},out_grouping:function(r,t,n){if(this.cursor<this.limit){var i=e.charCodeAt(this.cursor);if(i>n||i<t)return this.cursor++,!0;if(i-=t,!(r[i>>3]&1<<(7&i)))return this.cursor++,!0}return!1},out_grouping_b:function(r,t,n){if(this.cursor>this.limit_backward){var i=e.charCodeAt(this.cursor-1);if(i>n||i<t)return this.cursor--,!0;if(i-=t,!(r[i>>3]&1<<(7&i)))return this.cursor--,!0}return!1},eq_s:function(r,t){if(this.limit-this.cursor<r)return!1;for(var n=0;n<r;n++)if(e.charCodeAt(this.cursor+n)!=t.charCodeAt(n))return!1;return this.cursor+=r,!0},eq_s_b:function(r,t){if(this.cursor-this.limit_backward<r)return!1;for(var n=0;n<r;n++)if(e.charCodeAt(this.cursor-r+n)!=t.charCodeAt(n))return!1;return this.cursor-=r,!0},find_among:function(r,t){for(var n=0,i=t,a=this.cursor,s=this.limit,o=0,u=0,c=!1;;){for(var l=n+(i-n>>1),f=0,g=o<u?o:u,v=r[l],d=g;d<v.s_size;d++){if(a+g==s){f=-1;break}if(f=e.charCodeAt(a+g)-v.s[d])break;g++}if(f<0?(i=l,u=g):(n=l,o=g),i-n<=1){if(n>0||i==n||c)break;c=!0}}for(;;){var v=r[n];if(o>=v.s_size){if(this.cursor=a+v.s_size,!v.method)return v.result;var m=v.method();if(this.cursor=a+v.s_size,m)return v.result}if((n=v.substring_i)<0)return 0}},find_among_b:function(r,t){for(var n=0,i=t,a=this.cursor,s=this.limit_backward,o=0,u=0,c=!1;;){for(var l=n+(i-n>>1),f=0,g=o<u?o:u,v=r[l],d=v.s_size-1-g;d>=0;d--){if(a-g==s){f=-1;break}if(f=e.charCodeAt(a-1-g)-v.s[d])break;g++}if(f<0?(i=l,u=g):(n=l,o=g),i-n<=1){if(n>0||i==n||c)break;c=!0}}for(;;){var v=r[n];if(o>=v.s_size){if(this.cursor=a-v.s_size,!v.method)return v.result;var m=v.method();if(this.cursor=a-v.s_size,m)return v.result}if((n=v.substring_i)<0)return 0}},replace_s:function(r,t,n){var i=n.length-(t-r),a=e.substring(0,r),s=e.substring(t);return e=a+n+s,this.limit+=i,this.cursor>=t?this.cursor+=i:this.cursor>r&&(this.cursor=r),i},slice_check:function(){if(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>e.length)throw"faulty slice operation"},slice_from:function(e){this.slice_check(),this.replace_s(this.bra,this.ket,e)},slice_del:function(){this.slice_from("")},insert:function(e,r,t){var n=this.replace_s(e,r,t);e<=this.bra&&(this.bra+=n),e<=this.ket&&(this.ket+=n)},slice_to:function(){return this.slice_check(),e.substring(this.bra,this.ket)},eq_v_b:function(e){return this.eq_s_b(e.length,e)}}}},Bravey.FreeTextEntityRecognizer=function(e,r){var t=/\"([^\"]*)\"/,n=[],i=[];this.getName=function(){return e},this.addPrefix=function(e){-1==n.indexOf(e)&&n.push(e)},this.addConjunction=function(e){i.push(new RegExp("^\\b"+e+"\\b","gi")),i.push(new RegExp("\\b"+e+"\\b$","gi"))},this.getEntities=function(e,r){return r},this.expand=function(e){var r,a,s=-1,o=-1;if(null!=(a=t.exec(e.string)))e.position+=a.index+1,e.string=a[1];else{for(var u=0;u<n.length;u++)-1!=(r=e.string.indexOf(n[u]))&&(-1==o||r<o)&&(o=r,s=r+n[u].length);-1!=s&&(e.position+=s,e.string=e.string.substr(s)),Bravey.Text.entityTrim(e);do{o=0;for(var u=0;u<i.length;u++)null!=(a=i[u].exec(e.string))&&(o=1,0==a.index?(e.string=e.string.substr(a[0].length),e.position+=a[0].length):e.string=e.string.substr(0,a.index),Bravey.Text.entityTrim(e))}while(o);-1!=(r=e.string.lastIndexOf("."))&&(e.string=e.string.substr(0,r)),Bravey.Text.entityTrim(e)}e.value=e.string}},Bravey.StringEntityRecognizer=function(e,r){function t(){n.sort(function(e,r){return e.text.length>r.text.length?-1:e.text.length<r.text.length?1:0})}var n=[],i={},a=!1;this.getName=function(){return e},this.addMatch=function(e,r){return r=Bravey.Text.clean(r),i[r]||(i[r]=1,a=!1,n.push({text:r,id:e,regex:new RegExp("\\b"+r+"\\b","gi")})),!0},this.getEntities=function(i,s){i=Bravey.Text.clean(i),a||(a=!0,t());var o,u;s||(s=[]);for(var c,l=i,f=0;f<n.length;f++)for(;null!=(u=n[f].regex.exec(l));){o=i.substr(u.index,u[0].length),s.push({position:u.index,entity:e,value:n[f].id,string:o,priority:r||0}),c=l.substr(0,u.index);for(var g=0;g<u[0].length;g++)c+=" ";c+=l.substr(u.index+u[0].length),l=c}return s}},Bravey.NumberEntityRecognizer=function(e){var r=new RegExp("\\b[0-9]+\\b","gi");this.getName=function(){return e},this.getEntities=function(t,n){t=Bravey.Text.clean(t);var i,a;n||(n=[]);for(var s=t;null!=(a=r.exec(s));)i=t.substr(a.index,a[0].length),n.push({position:a.index,entity:e,value:1*i,string:i});return n}},Bravey.RegexEntityRecognizer=function(e){function r(e){e.sort(function(e,r){return e.position<r.position?-1:e.position>r.position?1:e.string.length>r.string.length?-1:e.string.length<r.string.length?1:e.priority>r.priority?-1:e.priority<r.priority?1:0})}var t=[];this.addMatch=function(e,r,n){t.push({regex:e,callback:r,priority:n||0})},this.getName=function(){return e},this.getEntities=function(n,i){n=Bravey.Text.clean(n);var a,s,o,u=[],c=-1;i||(i=[]);for(var l=n,f=0;f<t.length;f++)for(;null!=(o=t[f].regex.exec(l));)s=n.substr(o.index,o[0].length),void 0!==(a=t[f].callback(o))&&u.push(Bravey.Text.entityTrim({value:a,entity:e,position:o.index,string:s,priority:t[f].priority}));r(u);for(var f=0;f<u.length;f++)u[f].position>=c&&(i.push(u[f]),c=u[f].position+u[f].string.length);return i},this.bindTo=function(e){var r=this;e.getName=function(){return r.getName()},e.getEntities=function(e,t){return r.getEntities(e,t)}}},Bravey.EMailEntityRecognizer=function(e,r){var t=/(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))/g;this.getName=function(){return e},this.getEntities=function(n,i){var a,s;for(i||(i=[]);null!=(s=t.exec(n));)a=n.substr(s.index,s[0].length),i.push({position:s.index,entity:e,value:a,string:a,priority:r||0});return i}},Bravey.DocumentClassifier=function(e){e=e||{};var r={},t=function(e,r){return"stem:"+e+"::label:"+r},n=function(e){return"docCount:"+e},i=function(e){return"stemCount:"+e},a=function(e){},s=function(){var e=r.registeredLabels;return e||(e=""),e.split(",").filter(function(e){return e.length})},o=function(e){var t=s();return-1===t.indexOf(e)&&(t.push(e),r.registeredLabels=t.join(",")),!0},u=function(e,n){var i=parseInt(r[t(e,n)]);return i||(i=0),i},c=function(e,r){for(var t=s(),n=0,i=0,a=t.length;i<a;i++)t[i]!==r&&(n+=parseInt(u(e,t[i])));return n},l=function(e){var t=parseInt(r[i(e)]);return t||(t=0),t},f=function(e){var t=parseInt(r[n(e)]);return t||(t=0),t},g=function(e){for(var r=s(),t=0,n=0,i=r.length;n<i;n++)r[n]!==e&&(t+=parseInt(f(r[n])));return t},v=function(e){var t=parseInt(r[e]);return t||(t=0),r[e]=parseInt(t)+1,t+1},d=function(e,r){v(i(e)),v(t(e,r))},m=function(e){return v(n(e))},b=function(r,t){o(t);var n=Bravey.Text.tokenize(Bravey.Text.clean(r));e.filter&&(n=e.filter(n));for(var i=n.length,a=0;a<i;a++)d(e.stemmer?e.stemmer(n[a]):n[a],t);m(t)},h=function(r){var t=Bravey.Text.tokenize(Bravey.Text.clean(r));e.filter&&(t=e.filter(t));for(var n=t.length,i=s(),o=0,v={},d={},m={},b={},h=0;h<i.length;h++){var y=i[h];v[y]=f(y),d[y]=g(y),o+=parseInt(v[y])}for(var h=0;h<i.length;h++){var y=i[h],w=0;b[y]=v[y]/o;for(var p=0;p<n;p++){var x=e.stemmer?e.stemmer(t[p]):t[p],_=l(x);if(0!==_){var B=u(x,y)/v[y],D=c(x,y)/d[y],T=B/(B+D);T=(.5+_*T)/(1+_),0===T?T=.01:1===T&&(T=.99),w+=Math.log(1-T)-Math.log(T),a(y+"icity of "+x+": "+T)}}m[y]=1/(1+Math.exp(w))}return m},y=function(e){var r=0,t=null;for(var n in e)e[n]>r&&(r=e[n],t=n);return{label:t,score:r}};this.addDocument=function(e,r){return b(e,r),e},this.classifyDocument=function(e){var r=h(e);return{scores:r,winner:y(r)}},this.addDocument("","none")},Bravey.Language.IT={},Bravey.Language.IT.Stemmer=function(){var e=Bravey.stemmerSupport.Among,r=Bravey.stemmerSupport.SnowballProgram,t=new function(){function t(e,r,t){return!(!M.eq_s(1,e)||(M.ket=M.cursor,!M.in_grouping(S,97,249)))&&(M.slice_from(r),M.cursor=t,!0)}function n(){for(var e,r,n,i,a=M.cursor;;){if(M.bra=M.cursor,e=M.find_among(x,7))switch(M.ket=M.cursor,e){case 1:M.slice_from("à");continue;case 2:M.slice_from("è");continue;case 3:M.slice_from("ì");continue;case 4:M.slice_from("ò");continue;case 5:M.slice_from("ù");continue;case 6:M.slice_from("qU");continue;case 7:if(M.cursor>=M.limit)break;M.cursor++;continue}break}for(M.cursor=a;;)for(r=M.cursor;;){if(n=M.cursor,M.in_grouping(S,97,249)){if(M.bra=M.cursor,i=M.cursor,t("u","U",n))break;if(M.cursor=i,t("i","I",n))break}if(M.cursor=n,M.cursor>=M.limit)return void(M.cursor=r);M.cursor++}}function i(e){if(M.cursor=e,!M.in_grouping(S,97,249))return!1;for(;!M.out_grouping(S,97,249);){if(M.cursor>=M.limit)return!1;M.cursor++}return!0}function a(){if(M.in_grouping(S,97,249)){var e=M.cursor;if(M.out_grouping(S,97,249)){for(;!M.in_grouping(S,97,249);){if(M.cursor>=M.limit)return i(e);M.cursor++}return!0}return i(e)}return!1}function s(){var e,r=M.cursor;if(!a()){if(M.cursor=r,!M.out_grouping(S,97,249))return;if(e=M.cursor,M.out_grouping(S,97,249)){for(;!M.in_grouping(S,97,249);){if(M.cursor>=M.limit)return M.cursor=e,void(M.in_grouping(S,97,249)&&M.cursor<M.limit&&M.cursor++);M.cursor++}return void(p=M.cursor)}if(M.cursor=e,!M.in_grouping(S,97,249)||M.cursor>=M.limit)return;M.cursor++}p=M.cursor}function o(){for(;!M.in_grouping(S,97,249);){if(M.cursor>=M.limit)return!1;M.cursor++}for(;!M.out_grouping(S,97,249);){if(M.cursor>=M.limit)return!1;M.cursor++}return!0}function u(){var e=M.cursor;p=M.limit,w=p,y=p,s(),M.cursor=e,o()&&(w=M.cursor,o()&&(y=M.cursor))}function c(){for(var e;;){if(M.bra=M.cursor,!(e=M.find_among(_,3)))break;switch(M.ket=M.cursor,e){case 1:M.slice_from("i");break;case 2:M.slice_from("u");break;case 3:if(M.cursor>=M.limit)return;M.cursor++}}}function l(){return p<=M.cursor}function f(){return w<=M.cursor}function g(){return y<=M.cursor}function v(){var e;if(M.ket=M.cursor,M.find_among_b(B,37)&&(M.bra=M.cursor,(e=M.find_among_b(D,5))&&l()))switch(e){case 1:M.slice_del();break;case 2:M.slice_from("e")}}function d(){var e;if(M.ket=M.cursor,!(e=M.find_among_b(E,51)))return!1;switch(M.bra=M.cursor,e){case 1:if(!g())return!1;M.slice_del();break;case 2:if(!g())return!1;M.slice_del(),M.ket=M.cursor,M.eq_s_b(2,"ic")&&(M.bra=M.cursor,g()&&M.slice_del());break;case 3:if(!g())return!1;M.slice_from("log");break;case 4:if(!g())return!1;M.slice_from("u");break;case 5:if(!g())return!1;M.slice_from("ente");break;case 6:if(!l())return!1;M.slice_del();break;case 7:if(!f())return!1;M.slice_del(),M.ket=M.cursor,e=M.find_among_b(T,4),e&&(M.bra=M.cursor,g()&&(M.slice_del(),1==e&&(M.ket=M.cursor,M.eq_s_b(2,"at")&&(M.bra=M.cursor,g()&&M.slice_del()))));break;case 8:if(!g())return!1;M.slice_del(),M.ket=M.cursor,e=M.find_among_b(k,3),e&&(M.bra=M.cursor,1==e&&g()&&M.slice_del());break;case 9:if(!g())return!1;M.slice_del(),M.ket=M.cursor,M.eq_s_b(2,"at")&&(M.bra=M.cursor,g()&&(M.slice_del(),M.ket=M.cursor,M.eq_s_b(2,"ic")&&(M.bra=M.cursor,g()&&M.slice_del())))}return!0}function m(){var e,r;M.cursor>=p&&(r=M.limit_backward,M.limit_backward=p,M.ket=M.cursor,e=M.find_among_b(R,87),e&&(M.bra=M.cursor,1==e&&M.slice_del()),M.limit_backward=r)}function b(){var e=M.limit-M.cursor;if(M.ket=M.cursor,M.in_grouping_b(C,97,242)&&(M.bra=M.cursor,l()&&(M.slice_del(),M.ket=M.cursor,M.eq_s_b(1,"i")&&(M.bra=M.cursor,l()))))return void M.slice_del();M.cursor=M.limit-e}function h(){b(),M.ket=M.cursor,M.eq_s_b(1,"h")&&(M.bra=M.cursor,M.in_grouping_b(z,99,103)&&l()&&M.slice_del())}var y,w,p,x=[new e("",-1,7),new e("qu",0,6),new e("á",0,1),new e("é",0,2),new e("í",0,3),new e("ó",0,4),new e("ú",0,5)],_=[new e("",-1,3),new e("I",0,1),new e("U",0,2)],B=[new e("la",-1,-1),new e("cela",0,-1),new e("gliela",0,-1),new e("mela",0,-1),new e("tela",0,-1),new e("vela",0,-1),new e("le",-1,-1),new e("cele",6,-1),new e("gliele",6,-1),new e("mele",6,-1),new e("tele",6,-1),new e("vele",6,-1),new e("ne",-1,-1),new e("cene",12,-1),new e("gliene",12,-1),new e("mene",12,-1),new e("sene",12,-1),new e("tene",12,-1),new e("vene",12,-1),new e("ci",-1,-1),new e("li",-1,-1),new e("celi",20,-1),new e("glieli",20,-1),new e("meli",20,-1),new e("teli",20,-1),new e("veli",20,-1),new e("gli",20,-1),new e("mi",-1,-1),new e("si",-1,-1),new e("ti",-1,-1),new e("vi",-1,-1),new e("lo",-1,-1),new e("celo",31,-1),new e("glielo",31,-1),new e("melo",31,-1),new e("telo",31,-1),new e("velo",31,-1)],D=[new e("ando",-1,1),new e("endo",-1,1),new e("ar",-1,2),new e("er",-1,2),new e("ir",-1,2)],T=[new e("ic",-1,-1),new e("abil",-1,-1),new e("os",-1,-1),new e("iv",-1,1)],k=[new e("ic",-1,1),new e("abil",-1,1),new e("iv",-1,1)],E=[new e("ica",-1,1),new e("logia",-1,3),new e("osa",-1,1),new e("ista",-1,1),new e("iva",-1,9),new e("anza",-1,1),new e("enza",-1,5),new e("ice",-1,1),new e("atrice",7,1),new e("iche",-1,1),new e("logie",-1,3),new e("abile",-1,1),new e("ibile",-1,1),new e("usione",-1,4),new e("azione",-1,2),new e("uzione",-1,4),new e("atore",-1,2),new e("ose",-1,1),new e("ante",-1,1),new e("mente",-1,1),new e("amente",19,7),new e("iste",-1,1),new e("ive",-1,9),new e("anze",-1,1),new e("enze",-1,5),new e("ici",-1,1),new e("atrici",25,1),new e("ichi",-1,1),new e("abili",-1,1),new e("ibili",-1,1),new e("ismi",-1,1),new e("usioni",-1,4),new e("azioni",-1,2),new e("uzioni",-1,4),new e("atori",-1,2),new e("osi",-1,1),new e("anti",-1,1),new e("amenti",-1,6),new e("imenti",-1,6),new e("isti",-1,1),new e("ivi",-1,9),new e("ico",-1,1),new e("ismo",-1,1),new e("oso",-1,1),new e("amento",-1,6),new e("imento",-1,6),new e("ivo",-1,9),new e("ità",-1,8),new e("istà",-1,1),new e("istè",-1,1),new e("istì",-1,1)],R=[new e("isca",-1,1),new e("enda",-1,1),new e("ata",-1,1),new e("ita",-1,1),new e("uta",-1,1),new e("ava",-1,1),new e("eva",-1,1),new e("iva",-1,1),new e("erebbe",-1,1),new e("irebbe",-1,1),new e("isce",-1,1),new e("ende",-1,1),new e("are",-1,1),new e("ere",-1,1),new e("ire",-1,1),new e("asse",-1,1),new e("ate",-1,1),new e("avate",16,1),new e("evate",16,1),new e("ivate",16,1),new e("ete",-1,1),new e("erete",20,1),new e("irete",20,1),new e("ite",-1,1),new e("ereste",-1,1),new e("ireste",-1,1),new e("ute",-1,1),new e("erai",-1,1),new e("irai",-1,1),new e("isci",-1,1),new e("endi",-1,1),new e("erei",-1,1),new e("irei",-1,1),new e("assi",-1,1),new e("ati",-1,1),new e("iti",-1,1),new e("eresti",-1,1),new e("iresti",-1,1),new e("uti",-1,1),new e("avi",-1,1),new e("evi",-1,1),new e("ivi",-1,1),new e("isco",-1,1),new e("ando",-1,1),new e("endo",-1,1),new e("Yamo",-1,1),new e("iamo",-1,1),new e("avamo",-1,1),new e("evamo",-1,1),new e("ivamo",-1,1),new e("eremo",-1,1),new e("iremo",-1,1),new e("assimo",-1,1),new e("ammo",-1,1),new e("emmo",-1,1),new e("eremmo",54,1),new e("iremmo",54,1),new e("immo",-1,1),new e("ano",-1,1),new e("iscano",58,1),new e("avano",58,1),new e("evano",58,1),new e("ivano",58,1),new e("eranno",-1,1),new e("iranno",-1,1),new e("ono",-1,1),new e("iscono",65,1),new e("arono",65,1),new e("erono",65,1),new e("irono",65,1),new e("erebbero",-1,1),new e("irebbero",-1,1),new e("assero",-1,1),new e("essero",-1,1),new e("issero",-1,1),new e("ato",-1,1),new e("ito",-1,1),new e("uto",-1,1),new e("avo",-1,1),new e("evo",-1,1),new e("ivo",-1,1),new e("ar",-1,1),new e("ir",-1,1),new e("erà",-1,1),new e("irà",-1,1),new e("erò",-1,1),new e("irò",-1,1)],S=[17,65,16,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2,1],C=[17,65,0,0,0,0,0,0,0,0,0,0,0,0,0,128,128,8,2],z=[17],M=new r;this.setCurrent=function(e){M.setCurrent(e)},this.getCurrent=function(){return M.getCurrent()},this.stem=function(){var e=M.cursor;return n(),M.cursor=e,u(),M.limit_backward=e,M.cursor=M.limit,v(),M.cursor=M.limit,d()||(M.cursor=M.limit,m()),M.cursor=M.limit,h(),M.cursor=M.limit_backward,c(),!0}};return function(e){return t.setCurrent(e),t.stem(),t.getCurrent()}}(),Bravey.Language.IT.TimeEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t=new Bravey.Text.RegexMap([{str:["meno un quarto~"],val:-45*Bravey.Date.MINUTE},{str:["meno venti~"," meno 20"],val:-20*Bravey.Date.MINUTE},{str:["meno un quarto~"],val:-15*Bravey.Date.MINUTE},{str:["mezza~","trenta"],val:30*Bravey.Date.MINUTE},{str:["venti~"],val:30*Bravey.Date.MINUTE},{str:["un quarto~","quindici~","un quarto~"],val:15*Bravey.Date.MINUTE}],0),n=new Bravey.Text.RegexMap([{str:["di mattina~","del mattino~","am~","antimeridiane~"],val:0},{str:["di pomeriggio~","del pomeriggio~","di sera~","della sera~","pomeridiane~","pm~"],val:12*Bravey.Date.HOUR}],0);r.addMatch(new RegExp("\\b(per le\\b|l\\b|alle\\b|la\\b|le\\b)?"+Bravey.Text.WORDSEP+"(ore\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"(e\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+t.regex()+Bravey.Text.WORDSEP+"( minuti)?"+Bravey.Text.WORDSEP+n.regex()+"\\b","gi"),function(e){var r=1*e[3]*Bravey.Date.HOUR;if(e[4]&&e[5]&&(r+=1*e[5]*Bravey.Date.MINUTE),r+=t.get(e,6),r+=n.get(e,8),Bravey.Text.calculateScore(e,[1,2,5,6,7,8]))return Bravey.Date.formatTime(r)}),r.bindTo(this)},Bravey.Language.IT.TimePeriodEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t=new Bravey.Text.RegexMap([{str:["secondo~","secondi~"],val:Bravey.Date.SECOND},{str:["minuti~","minuto~"],val:Bravey.Date.MINUTE},{str:["ore~","ora~"],val:Bravey.Date.HOUR}],0);r.addMatch(new RegExp("\\b(entro\\b|tra\\b|in\\b)"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+t.regex(1),"gi"),function(e){var r,n,i=new Date;if(r=n=i.getHours()*Bravey.Date.HOUR+i.getMinutes()*Bravey.Date.MINUTE,n+=e[2]*t.get(e,3),Bravey.Text.calculateScore(e,[1,3]))return{start:Bravey.Date.formatTime(r),end:Bravey.Date.formatTime(n)}}),r.addMatch(new RegExp("\\b(di sera|della sera|in serata|nella serata|la sera|sera|stasera)\\b","gi"),function(e){return{start:"12:00:00",end:"23:59:00"}}),r.addMatch(new RegExp("\\b(di pomeriggio|del pomeriggio|nel pomeriggio|il pomeriggio|pomeriggio)\\b","gi"),function(e){return{start:"15:00:00",end:"23:59:00"}}),r.addMatch(new RegExp("\\b(di mattina|del mattino|in mattinata|della mattinata|la mattinata|mattina|stamattina)\\b","gi"),function(e){return{start:"08:00:00",end:"12:00:00"}}),r.bindTo(this)},Bravey.Language.IT.DateEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t="\\b(per il\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|il\\b|nel\\b)?(lo scorso\\b)?(questo?)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["gennaio~","gen~","1~","01~"],val:0},{str:["febbraio~","feb~","2~","02~"],val:1},{str:["marzo~","mar~","3~","03~"],val:2},{str:["aprile~","apr~","4~","04~"],val:3},{str:["maggio~","mag~","5~","05~"],val:4},{str:["giugno~","giu~","6~","06~"],val:5},{str:["luglio~","lug~","7~","07~"],val:6},{str:["agosto~","ago~","8~","08~"],val:7},{str:["settembre~","set~","sept~","9~","09~"],val:8},{str:["ottobre~","ott~","10~"],val:9},{str:["novembre~","nov~","11~"],val:10},{str:["dicembre~","dic~","12~"],val:11}],0);r.addMatch(new RegExp(t+"([0-9]{1,2})"+Bravey.Text.WORDSEP+"(di\\b|,\\b|/\\b|-\\b|\\b)"+Bravey.Text.WORDSEP+n.regex()+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|nel\\b|,\\b|/\\b|-\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=thismonth=r.getMonth(),a=r.getDate();if(a=1*e[4],i=n.get(e,6,i),e[8]&&(t=1*e[8]),t=Bravey.Date.centuryFinder(t),i>thismonth&&e[2]&&t--,Bravey.Text.calculateScore(e,[1,2,3,6,8]))return Bravey.Date.formatDate(new Date(t,i,a,0,0,0,0).getTime())},10),r.addMatch(new RegExp(t+n.regex(1)+Bravey.Text.WORDSEP+"([0-9]{1,2})?"+Bravey.Text.WORDSEP+"(del\\b|dell'\\b|,\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=thismonth=r.getMonth(),a=1;if(i=n.get(e,4,i),e[5]&&(a=1*e[5]),e[7]&&(t=1*e[7]),t=Bravey.Date.centuryFinder(t),i>thismonth&&e[2]&&t--,Bravey.Text.calculateScore(e,[1,2,3,5,6]))return Bravey.Date.formatDate(new Date(t,i,a,0,0,0,0).getTime())},5),t="\\b(per\\b|di\\b|nel giorno di\\b|nella giornata di\\b|la giornata di\\b|lo scorso\\b)?"+Bravey.Text.WORDSEP,r.addMatch(new RegExp(t+"(oggi)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),r.addMatch(new RegExp(t+"(domani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(dopodomani)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(ieri)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(l'altro ieri|ieri l'altro)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-2*Bravey.Date.DAY)}),r.bindTo(this)},Bravey.Language.IT.FreeTextEntityRecognizer=function(e,r){var t=["grazie","per favore"],n=new Bravey.FreeTextEntityRecognizer(e,r);n.addConjunction("il"),n.addConjunction("lo"),n.addConjunction("la"),n.addConjunction("i"),n.addConjunction("gli"),n.addConjunction("le"),n.addConjunction("è"),n.addConjunction("é"),n.addConjunction("e"),n.addConjunction("ed"),n.addConjunction("e'"),n.addConjunction("sia"),n.addConjunction("mi pare"),n.addConjunction("dovrebbe essere"),n.addConjunction("sarebbe");for(var i=0;i<t.length;i++)n.addConjunction(t[i]),n.addConjunction(","+t[i]),n.addConjunction(", "+t[i]);return n},Bravey.Language.IT.Numbers=[{prefix:"zero",value:0},{prefix:"vent",value:20},{prefix:"trent",value:30},{prefix:"quarant",value:40},{prefix:"cinquant",value:50},{prefix:"sessant",value:60},{prefix:"settant",value:70},{prefix:"ottant",value:80},{prefix:"novant",value:90},{prefix:"uno",value:1},{prefix:"quattro",value:4},{prefix:"quattor",value:4},{prefix:"cinque",value:5},{prefix:"quin",value:5},{prefix:"sei",value:6},{prefix:"sette",value:7},{prefix:"otto",value:8},{prefix:"nove",value:9},{prefix:"dieci",value:10},{prefix:"dici",value:10},{prefix:"se",value:6},{prefix:"un",value:1},{prefix:"due",value:2},{prefix:"do",value:2},{prefix:"tre",value:3},{prefix:"a",skip:1},{prefix:"tor",skip:1},{prefix:"i",skip:1},{prefix:"n",skip:1},{prefix:"s",skip:1},{prefix:"cento",mul:100},{prefix:"mila",mul:1e3,end:1},{prefix:"mille",mul:1e3,end:1},{prefix:"milion",mul:1e6,end:1},{prefix:"miliard",mul:1e9,end:1},{prefix:"e",skip:1},{prefix:"i",skip:1},{prefix:"o",skip:1}],Bravey.Language.IT.NumberEntityRecognizer=function(e,r){var t=new RegExp("^[0-9]+$","gi"),n=new Bravey.RegexEntityRecognizer(e);return n.addMatch(new RegExp("(\\w+)","gi"),function(e){var r,n,i=e[0].toLowerCase(),a=0,s=0,o=9990,u=!1;if(i.match(t))return 1*i;do{r=!1;for(var c=0;c<Bravey.Language.IT.Numbers.length&&(n=Bravey.Language.IT.Numbers[c],i.substr(0,n.prefix.length)!=n.prefix||(i=i.substr(n.prefix.length),n.skip?r=!0:(o?n.end?(c<o&&(a+=s,s=0),o=c):(a+=s,s=0,o=0):n.end&&(o=c),void 0!==n.value&&(s+=n.value,r=!0,u=!0),void 0!==n.mul&&(s?s*=n.mul:s=n.mul,r=!0,u=!0)),!r));c++);}while(r);return a+=s,!i&&u?a:void 0}),n},Bravey.Language.EN={},Bravey.Language.EN.Stemmer=function(){var e=Bravey.stemmerSupport.Among,r=Bravey.stemmerSupport.SnowballProgram,t=new function(){function t(){var e,r=A.cursor;for(y=!1,A.bra=A.cursor,A.eq_s(1,"'")&&(A.ket=A.cursor,A.slice_del()),A.cursor=r,A.bra=r,A.eq_s(1,"y")&&(A.ket=A.cursor,A.slice_from("Y"),y=!0),A.cursor=r;;)if(e=A.cursor,A.in_grouping(M,97,121)&&(A.bra=A.cursor,A.eq_s(1,"y")))A.ket=A.cursor,A.cursor=e,A.slice_from("Y"),y=!0;else{if(e>=A.limit)return void(A.cursor=r);A.cursor=e+1}}function n(){var e=A.cursor;if(p=A.limit,w=p,!A.find_among(x,3)&&(A.cursor=e,i()))return void(A.cursor=e);p=A.cursor,i()||(w=A.cursor)}function i(){for(;!A.in_grouping(M,97,121);){if(A.cursor>=A.limit)return!0;A.cursor++}for(;!A.out_grouping(M,97,121);){if(A.cursor>=A.limit)return!0;A.cursor++}return!1}function a(){var e=A.limit-A.cursor;return!(!(A.out_grouping_b(O,89,121)&&A.in_grouping_b(M,97,121)&&A.out_grouping_b(M,97,121))&&(A.cursor=A.limit-e,!A.out_grouping_b(M,97,121)||!A.in_grouping_b(M,97,121)||A.cursor>A.limit_backward))}function s(){return p<=A.cursor}function o(){return w<=A.cursor}function u(){var e,r=A.limit-A.cursor;if(A.ket=A.cursor,e=A.find_among_b(_,3),e?(A.bra=A.cursor,1==e&&A.slice_del()):A.cursor=A.limit-r,A.ket=A.cursor,e=A.find_among_b(B,6))switch(A.bra=A.cursor,e){case 1:A.slice_from("ss");break;case 2:var t=A.cursor-2;if(A.limit_backward>t||t>A.limit){A.slice_from("ie");break}A.cursor=t,A.slice_from("i");break;case 3:do{if(A.cursor<=A.limit_backward)return;A.cursor--}while(!A.in_grouping_b(M,97,121));A.slice_del()}}function c(){var e,r,t,n;if(A.ket=A.cursor,e=A.find_among_b(T,6))switch(A.bra=A.cursor,e){case 1:s()&&A.slice_from("ee");break;case 2:for(r=A.limit-A.cursor;!A.in_grouping_b(M,97,121);){if(A.cursor<=A.limit_backward)return;A.cursor--}if(A.cursor=A.limit-r,A.slice_del(),t=A.limit-A.cursor,e=A.find_among_b(D,13))switch(A.cursor=A.limit-t,e){case 1:var i=A.cursor;A.insert(A.cursor,A.cursor,"e"),A.cursor=i;break;case 2:A.ket=A.cursor,A.cursor>A.limit_backward&&(A.cursor--,A.bra=A.cursor,A.slice_del());break;case 3:if(A.cursor==p&&(n=A.limit-A.cursor,a())){A.cursor=A.limit-n;var i=A.cursor;A.insert(A.cursor,A.cursor,"e"),A.cursor=i}}}}function l(){var e=A.limit-A.cursor;A.ket=A.cursor,(A.eq_s_b(1,"y")||(A.cursor=A.limit-e,A.eq_s_b(1,"Y")))&&(A.bra=A.cursor,A.out_grouping_b(M,97,121)&&A.cursor>A.limit_backward&&A.slice_from("i"))}function f(){var e;if(A.ket=A.cursor,(e=A.find_among_b(k,24))&&(A.bra=A.cursor,s()))switch(e){case 1:A.slice_from("tion");break;case 2:A.slice_from("ence");break;case 3:A.slice_from("ance");break;case 4:A.slice_from("able");break;case 5:A.slice_from("ent");break;case 6:A.slice_from("ize");break;case 7:A.slice_from("ate");break;case 8:A.slice_from("al");break;case 9:A.slice_from("ful");break;case 10:A.slice_from("ous");break;case 11:A.slice_from("ive");break;case 12:A.slice_from("ble");break;case 13:A.eq_s_b(1,"l")&&A.slice_from("og");break;case 14:A.slice_from("ful");break;case 15:A.slice_from("less");break;case 16:A.in_grouping_b(N,99,116)&&A.slice_del()}}function g(){var e;if(A.ket=A.cursor,(e=A.find_among_b(E,9))&&(A.bra=A.cursor,s()))switch(e){case 1:A.slice_from("tion");break;case 2:A.slice_from("ate");break;case 3:A.slice_from("al");break;case 4:A.slice_from("ic");break;case 5:A.slice_del();break;case 6:o()&&A.slice_del()}}function v(){var e,r;if(A.ket=A.cursor,(e=A.find_among_b(R,18))&&(A.bra=A.cursor,o()))switch(e){case 1:A.slice_del();break;case 2:if(r=A.limit-A.cursor,!A.eq_s_b(1,"s")&&(A.cursor=A.limit-r,!A.eq_s_b(1,"t")))return;A.slice_del()}}function d(){var e,r;if(A.ket=A.cursor,e=A.find_among_b(S,2))switch(A.bra=A.cursor,e){case 1:if(r=A.limit-A.cursor,!o()){if(A.cursor=A.limit-r,!s()||a())return;A.cursor=A.limit-r}A.slice_del();break;case 2:if(!o()||!A.eq_s_b(1,"l"))return;A.slice_del()}}function m(){return A.ket=A.cursor,!!A.find_among_b(C,8)&&(A.bra=A.cursor,A.cursor<=A.limit_backward)}function b(){var e;if(A.bra=A.cursor,(e=A.find_among(z,18))&&(A.ket=A.cursor,A.cursor>=A.limit)){switch(e){case 1:A.slice_from("ski");break;case 2:A.slice_from("sky");break;case 3:A.slice_from("die");break;case 4:A.slice_from("lie");break;case 5:A.slice_from("tie");break;case 6:A.slice_from("idl");break;case 7:A.slice_from("gentl");break;case 8:A.slice_from("ugli");break;case 9:A.slice_from("earli");break;case 10:A.slice_from("onli");break;case 11:A.slice_from("singl")}return!0}return!1}function h(){var e;if(y)for(;;)if(e=A.cursor,A.bra=e,A.eq_s(1,"Y"))A.ket=A.cursor,A.cursor=e,A.slice_from("y");else{if(A.cursor=e,A.cursor>=A.limit)return;A.cursor++}}var y,w,p,x=[new e("arsen",-1,-1),new e("commun",-1,-1),new e("gener",-1,-1)],_=[new e("'",-1,1),new e("'s'",0,1),new e("'s",-1,1)],B=[new e("ied",-1,2),new e("s",-1,3),new e("ies",1,2),new e("sses",1,1),new e("ss",1,-1),new e("us",1,-1)],D=[new e("",-1,3),new e("bb",0,2),new e("dd",0,2),new e("ff",0,2),new e("gg",0,2),new e("bl",0,1),new e("mm",0,2),new e("nn",0,2),new e("pp",0,2),new e("rr",0,2),new e("at",0,1),new e("tt",0,2),new e("iz",0,1)],T=[new e("ed",-1,2),new e("eed",0,1),new e("ing",-1,2),new e("edly",-1,2),new e("eedly",3,1),new e("ingly",-1,2)],k=[new e("anci",-1,3),new e("enci",-1,2),new e("ogi",-1,13),new e("li",-1,16),new e("bli",3,12),new e("abli",4,4),new e("alli",3,8),new e("fulli",3,14),new e("lessli",3,15),new e("ousli",3,10),new e("entli",3,5),new e("aliti",-1,8),new e("biliti",-1,12),new e("iviti",-1,11),new e("tional",-1,1),new e("ational",14,7),new e("alism",-1,8),new e("ation",-1,7),new e("ization",17,6),new e("izer",-1,6),new e("ator",-1,7),new e("iveness",-1,11),new e("fulness",-1,9),new e("ousness",-1,10)],E=[new e("icate",-1,4),new e("ative",-1,6),new e("alize",-1,3),new e("iciti",-1,4),new e("ical",-1,4),new e("tional",-1,1),new e("ational",5,2),new e("ful",-1,5),new e("ness",-1,5)],R=[new e("ic",-1,1),new e("ance",-1,1),new e("ence",-1,1),new e("able",-1,1),new e("ible",-1,1),new e("ate",-1,1),new e("ive",-1,1),new e("ize",-1,1),new e("iti",-1,1),new e("al",-1,1),new e("ism",-1,1),new e("ion",-1,2),new e("er",-1,1),new e("ous",-1,1),new e("ant",-1,1),new e("ent",-1,1),new e("ment",15,1),new e("ement",16,1)],S=[new e("e",-1,1),new e("l",-1,2)],C=[new e("succeed",-1,-1),new e("proceed",-1,-1),new e("exceed",-1,-1),new e("canning",-1,-1),new e("inning",-1,-1),new e("earring",-1,-1),new e("herring",-1,-1),new e("outing",-1,-1)],z=[new e("andes",-1,-1),new e("atlas",-1,-1),new e("bias",-1,-1),new e("cosmos",-1,-1),new e("dying",-1,3),new e("early",-1,9),new e("gently",-1,7),new e("howe",-1,-1),new e("idly",-1,6),new e("lying",-1,4),new e("news",-1,-1),new e("only",-1,10),new e("singly",-1,11),new e("skies",-1,2),new e("skis",-1,1),new e("sky",-1,-1),new e("tying",-1,5),new e("ugly",-1,8)],M=[17,65,16,1],O=[1,17,65,208,1],N=[55,141,2],P=[c,l,f,g,v,d],A=new r;this.setCurrent=function(e){A.setCurrent(e)},this.getCurrent=function(){return A.getCurrent()},this.stem=function(){var e=A.cursor;if(!b()){A.cursor=e;var r=A.cursor+3;if(0<=r&&r<=A.limit){if(A.cursor=e,t(),A.cursor=e,n(),A.limit_backward=e,A.cursor=A.limit,u(),A.cursor=A.limit,!m())for(var i=0;i<P.length;i++)A.cursor=A.limit,P[i]();A.cursor=A.limit_backward,h()}}return!0}};return function(e){return t.setCurrent(e),t.stem(),t.getCurrent()}}(),Bravey.Language.EN.TimeEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t=new Bravey.Text.RegexMap([{str:["quarter to~"],val:-15*Bravey.Date.MINUTE},{str:["half past~"],val:30*Bravey.Date.MINUTE},{str:["quarter past~"],val:15*Bravey.Date.MINUTE}],0),n=new Bravey.Text.RegexMap([{str:["in the morning~","am~"],val:0},{str:["in the afternoon~","in the evening~","pm~"],val:12*Bravey.Date.HOUR}],0);r.addMatch(new RegExp("\\b(at\\b)?"+Bravey.Text.WORDSEP+t.regex()+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"(and\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+"(minutes\\b)?"+Bravey.Text.WORDSEP+"(o'clock\\b)?"+Bravey.Text.WORDSEP+n.regex(),"gi"),function(e){var r=1*e[3]*Bravey.Date.HOUR;if(e[5]&&(r+=1*e[5]*Bravey.Date.MINUTE),r+=t.get(e,2),r+=n.get(e,8),Bravey.Text.calculateScore(e,[1,2,4,5,6,7,8]))return Bravey.Date.formatTime(r)}),r.bindTo(this)},Bravey.Language.EN.TimePeriodEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t=new Bravey.Text.RegexMap([{str:["second","seconds"],val:Bravey.Date.SECOND},{str:["minute","minutes"],val:Bravey.Date.MINUTE},{str:["hour","hours"],val:Bravey.Date.HOUR}],0);r.addMatch(new RegExp("\\b(in\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+t.regex(1)+"\\b","gi"),function(e){var r,n,i=new Date;if(n=r=i.getHours()*Bravey.Date.HOUR+i.getMinutes()*Bravey.Date.MINUTE,r+=e[2]*t.get(e,3),Bravey.Text.calculateScore(e,[1,3]))return{start:Bravey.Date.formatTime(n),end:Bravey.Date.formatTime(r)}}),r.addMatch(new RegExp("\\b(in the evening|this evening|evening)\\b","gi"),function(e){return{start:"12:00:00",end:"23:59:00"}}),r.addMatch(new RegExp("\\b(in the afternoon|this afternoon|afternoon)\\b","gi"),function(e){return{start:"15:00:00",end:"23:59:00"}}),r.addMatch(new RegExp("\\b(in the morning|this morning|morning)\\b","gi"),function(e){return{start:"08:00:00",end:"12:00:00"}}),r.bindTo(this)},Bravey.Language.EN.DateEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t="\\b(day of)?(last\\b)?(this\\b)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["january~","jan~","1~","01~"],val:0},{str:["february~","feb~","2~","02~"],val:1},{str:["march~","mar~","3~","03~"],val:2},{str:["april~","apr~","4~","04~"],val:3},{str:["may~","may~","5~","05~"],val:4},{str:["june~","june~","6~","06~"],val:5},{str:["july~","july~","7~","07~"],val:6},{str:["august~","aug~","8~","08~"],val:7},{str:["september~","sep~","sept~","9~","09~"],val:8},{str:["october~","oct~","10~"],val:9},{str:["november~","nov~","11~"],val:10},{str:["december~","dec~","12~"],val:11}],0);r.addMatch(new RegExp(t+n.regex(1)+Bravey.Text.WORDSEP+"([0-9]{1,2})?"+Bravey.Text.WORDSEP+"(st\\b|nd\\b|rd\\b|th\\b)?"+Bravey.Text.WORDSEP+"(of\\b|,\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=thismonth=r.getMonth(),a=1;if(i=n.get(e,4,i),e[5]&&(a=1*e[5]),e[8]&&(t=1*e[8]),t=Bravey.Date.centuryFinder(t),i>thismonth&&e[2]&&t--,Bravey.Text.calculateScore(e,[1,2,3,5,8]))return Bravey.Date.formatDate(new Date(t,i,a,0,0,0,0).getTime())}),r.addMatch(new RegExp(t+"([0-9]{1,2})"+Bravey.Text.WORDSEP+"(st\\b|nd\\b|rd\\b|th\\b)?"+Bravey.Text.WORDSEP+"(of\\b|,\\b|/\\b|-\\b|\\b)"+Bravey.Text.WORDSEP+n.regex()+"(of\\b|,\\b|/\\b|-\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=r.getMonth(),a=r.getDate();if(a=1*e[4],i=n.get(e,7,i),e[9]&&(t=1*e[9]),t=Bravey.Date.centuryFinder(t),i>thismonth&&e[2]&&t--,Bravey.Text.calculateScore(e,[1,2,3,7,9]))return Bravey.Date.formatDate(new Date(t,i,a,0,0,0,0).getTime())},10),t="\\b(day of)?"+Bravey.Text.WORDSEP,r.addMatch(new RegExp(t+"(today)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),r.addMatch(new RegExp(t+"(tomorrow)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(the day after tomorrow)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(yesterday)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),r.bindTo(this)},Bravey.Language.EN.FreeTextEntityRecognizer=function(e,r){var t=["thanks","please"],n=new Bravey.FreeTextEntityRecognizer(e,r);n.addConjunction("is"),n.addConjunction("are"),n.addConjunction("should be"),n.addConjunction("may be");for(var i=0;i<t.length;i++)n.addConjunction(t[i]),n.addConjunction(","+t[i]),n.addConjunction(", "+t[i]);return n},Bravey.Language.EN.Numbers={wordsSeparator:/(\w+)([^\w]+)/gi,sum:{zero:0,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,eleven:11,twelve:12,thirteen:13,fourteen:14,fifteen:15,sixteen:16,seventeen:17,eighteen:18,nineteen:19,twenty:20,thirty:30,forty:40,fifty:50,sixty:60,seventy:70,eighty:80,ninety:90},mul:{thousand:1e3,million:1e6}},Bravey.Language.EN.NumberEntityRecognizer=function(e,r){this.getName=function(){return e},this.getEntities=function(t,n){n||(n=[]);for(var i,a,s,o,u,c,l=t.toLowerCase().split(/(\w+)/),f=0,g=0,v=0,d=0;d<l.length+1;d++)a=void 0==l[d]?"*":l[d],s=!0,o||(u=0,o={value:0,entity:e,string:"",priority:r||0}),a.trim()&&(null!=Bravey.Language.EN.Numbers.sum[a]?g+=Bravey.Language.EN.Numbers.sum[a]:"hundred"==a?g*=100:isNaN(1*a)?Bravey.Language.EN.Numbers.mul[a]?(i=Bravey.Language.EN.Numbers.mul[a],f+=g*i,g=0):s=!1:u?(d--,a="",s=!1):f=1*a,s?(u=1,c=v+a.length,void 0==o.position&&(o.position=v)):u&&(o.value=f+g,o.string=t.substr(o.position,c-o.position),n.push(o),f=g=o=0)),v+=a.length;return n}},Bravey.Language.PT={},Bravey.Language.PT.Stemmer=function(){function e(){this.setCurrent=function(e){this.current=e,this.cursor=0,this.limit=this.current.length,this.limit_backward=0,this.bra=this.cursor,this.ket=this.limit},this.getCurrent=function(){return this.current},this.copy_from=function(e){this.current=e.current,this.cursor=e.cursor,this.limit=e.limit,this.limit_backward=e.limit_backward,this.bra=e.bra,this.ket=e.ket},this.in_grouping=function(e,r,t){if(this.cursor>=this.limit)return!1;var n=this.current.charCodeAt(this.cursor);return!(n>t||n<r)&&(n-=r,0!=(e[n>>>3]&1<<(7&n))&&(this.cursor++,!0))},this.in_grouping_b=function(e,r,t){if(this.cursor<=this.limit_backward)return!1;var n=this.current.charCodeAt(this.cursor-1);return!(n>t||n<r)&&(n-=r,0!=(e[n>>>3]&1<<(7&n))&&(this.cursor--,!0))},this.out_grouping=function(e,r,t){if(this.cursor>=this.limit)return!1;var n=this.current.charCodeAt(this.cursor);return n>t||n<r?(this.cursor++,!0):(n-=r,0==(e[n>>>3]&1<<(7&n))&&(this.cursor++,!0))},this.out_grouping_b=function(e,r,t){if(this.cursor<=this.limit_backward)return!1;var n=this.current.charCodeAt(this.cursor-1);return n>t||n<r?(this.cursor--,!0):(n-=r,0==(e[n>>>3]&1<<(7&n))&&(this.cursor--,!0))},this.eq_s=function(e){return!(this.limit-this.cursor<e.length)&&(this.current.slice(this.cursor,this.cursor+e.length)==e&&(this.cursor+=e.length,!0))},this.eq_s_b=function(e){return!(this.cursor-this.limit_backward<e.length)&&(this.current.slice(this.cursor-e.length,this.cursor)==e&&(this.cursor-=e.length,!0))},this.find_among=function(e){for(var r=0,t=e.length,n=this.cursor,i=this.limit,a=0,s=0,o=!1;;){var u,c=r+(t-r>>>1),l=0,f=a<s?a:s,g=e[c];for(u=f;u<g[0].length;u++){if(n+f==i){l=-1;break}if(0!=(l=this.current.charCodeAt(n+f)-g[0].charCodeAt(u)))break;f++}if(l<0?(t=c,s=f):(r=c,a=f),t-r<=1){if(r>0)break;if(t==r)break;if(o)break;o=!0}}for(;;){var g=e[r];if(a>=g[0].length){if(this.cursor=n+g[0].length,g.length<4)return g[2];var v=g[3](this);if(this.cursor=n+g[0].length,v)return g[2]}if((r=g[1])<0)return 0}},this.find_among_b=function(e){for(var r=0,t=e.length,n=this.cursor,i=this.limit_backward,a=0,s=0,o=!1;;){var u,c=r+(t-r>>1),l=0,f=a<s?a:s,g=e[c];for(u=g[0].length-1-f;u>=0;u--){if(n-f==i){l=-1;break}if(0!=(l=this.current.charCodeAt(n-1-f)-g[0].charCodeAt(u)))break;f++}if(l<0?(t=c,s=f):(r=c,a=f),t-r<=1){if(r>0)break;if(t==r)break;if(o)break;o=!0}}for(;;){var g=e[r];if(a>=g[0].length){if(this.cursor=n-g[0].length,g.length<4)return g[2];var v=g[3](this);if(this.cursor=n-g[0].length,v)return g[2]}if((r=g[1])<0)return 0}},this.replace_s=function(e,r,t){var n=t.length-(r-e);return this.current=this.current.slice(0,e)+t+this.current.slice(r),this.limit+=n,this.cursor>=r?this.cursor+=n:this.cursor>e&&(this.cursor=e),n},this.slice_check=function(){return!(this.bra<0||this.bra>this.ket||this.ket>this.limit||this.limit>this.current.length)},this.slice_from=function(e){var r=!1;return this.slice_check()&&(this.replace_s(this.bra,this.ket,e),r=!0),r},this.slice_del=function(){return this.slice_from("")},this.insert=function(e,r,t){var n=this.replace_s(e,r,t);e<=this.bra&&(this.bra+=n),e<=this.ket&&(this.ket+=n)},this.slice_to=function(){var e="";return this.slice_check()&&(e=this.current.slice(this.bra,this.ket)),e},this.assign_to=function(){return this.current.slice(0,this.limit)}}function r(){function r(){var e;e:for(;;){var r=f.cursor;r:if(f.bra=f.cursor,0!=(e=f.find_among(g))){switch(f.ket=f.cursor,e){case 0:break r;case 1:if(!f.slice_from("a~"))return!1;break;case 2:if(!f.slice_from("o~"))return!1;break;case 3:if(f.cursor>=f.limit)break r;f.cursor++}continue e}f.cursor=r;break e}return!0}function t(){D=f.limit,B=f.limit,_=f.limit;var e=f.cursor;e:{r:{var r=f.cursor;t:if(f.in_grouping(x,97,250)){n:{var t=f.cursor;i:if(f.out_grouping(x,97,250)){a:for(;;){if(f.in_grouping(x,97,250))break a;if(f.cursor>=f.limit)break i;f.cursor++}break n}if(f.cursor=t,!f.in_grouping(x,97,250))break t;i:for(;;){if(f.out_grouping(x,97,250))break i;if(f.cursor>=f.limit)break t;f.cursor++}}break r}if(f.cursor=r,!f.out_grouping(x,97,250))break e;t:{var n=f.cursor;n:if(f.out_grouping(x,97,250)){i:for(;;){if(f.in_grouping(x,97,250))break i;if(f.cursor>=f.limit)break n;f.cursor++}break t}if(f.cursor=n,!f.in_grouping(x,97,250))break e;if(f.cursor>=f.limit)break e;f.cursor++}}D=f.cursor}f.cursor=e;var i=f.cursor;e:{r:for(;;){if(f.in_grouping(x,97,250))break r;if(f.cursor>=f.limit)break e;f.cursor++}r:for(;;){if(f.out_grouping(x,97,250))break r;if(f.cursor>=f.limit)break e;f.cursor++}B=f.cursor;r:for(;;){if(f.in_grouping(x,97,250))break r;if(f.cursor>=f.limit)break e;f.cursor++}r:for(;;){if(f.out_grouping(x,97,250))break r;if(f.cursor>=f.limit)break e;f.cursor++}_=f.cursor}return f.cursor=i,!0}function n(){var e;e:for(;;){var r=f.cursor;r:if(f.bra=f.cursor,0!=(e=f.find_among(v))){switch(f.ket=f.cursor,e){case 0:break r;case 1:if(!f.slice_from("ã"))return!1;break;case 2:if(!f.slice_from("õ"))return!1;break;case 3:if(f.cursor>=f.limit)break r;f.cursor++}continue e}f.cursor=r;break e}return!0}function i(){return D<=f.cursor}function a(){return B<=f.cursor}function s(){return _<=f.cursor}function o(){var e;if(f.ket=f.cursor,0==(e=f.find_among_b(h)))return!1;switch(f.bra=f.cursor,e){case 0:return!1;case 1:if(!s())return!1;if(!f.slice_del())return!1;break;case 2:if(!s())return!1;if(!f.slice_from("log"))return!1;break;case 3:if(!s())return!1;if(!f.slice_from("u"))return!1;break;case 4:if(!s())return!1;if(!f.slice_from("ente"))return!1;break;case 5:if(!a())return!1;if(!f.slice_del())return!1;var r=f.limit-f.cursor;e:if(f.ket=f.cursor,0!=(e=f.find_among_b(d)))if(f.bra=f.cursor,s()){if(!f.slice_del())return!1;switch(e){case 0:f.cursor=f.limit-r;break e;case 1:if(f.ket=f.cursor,!f.eq_s_b("at")){f.cursor=f.limit-r;break e}if(f.bra=f.cursor,!s()){f.cursor=f.limit-r;break e}if(!f.slice_del())return!1}}else f.cursor=f.limit-r;else f.cursor=f.limit-r;break;case 6:if(!s())return!1;if(!f.slice_del())return!1;var t=f.limit-f.cursor;e:if(f.ket=f.cursor,0!=(e=f.find_among_b(m)))switch(f.bra=f.cursor,e){case 0:f.cursor=f.limit-t;break e;case 1:if(!s()){f.cursor=f.limit-t;break e}if(!f.slice_del())return!1}else f.cursor=f.limit-t;break;case 7:if(!s())return!1;if(!f.slice_del())return!1;var n=f.limit-f.cursor;e:if(f.ket=f.cursor,0!=(e=f.find_among_b(b)))switch(f.bra=f.cursor,e){case 0:f.cursor=f.limit-n;break e;case 1:if(!s()){f.cursor=f.limit-n;break e}if(!f.slice_del())return!1}else f.cursor=f.limit-n;break;case 8:if(!s())return!1;if(!f.slice_del())return!1;var o=f.limit-f.cursor;if(f.ket=f.cursor,f.eq_s_b("at"))if(f.bra=f.cursor,s()){if(!f.slice_del())return!1}else f.cursor=f.limit-o;else f.cursor=f.limit-o;break;case 9:if(!i())return!1;if(!f.eq_s_b("e"))return!1;if(!f.slice_from("ir"))return!1}return!0}function u(){var e,r=f.limit-f.cursor;if(f.cursor<D)return!1;f.cursor=D;var t=f.limit_backward;if(f.limit_backward=f.cursor,f.cursor=f.limit-r,f.ket=f.cursor,0==(e=f.find_among_b(y)))return f.limit_backward=t,!1;switch(f.bra=f.cursor,e){case 0:return f.limit_backward=t,!1;case 1:if(!f.slice_del())return!1}return f.limit_backward=t,!0}function c(){var e;if(f.ket=f.cursor,0==(e=f.find_among_b(w)))return!1;switch(f.bra=f.cursor,e){case 0:return!1;case 1:if(!i())return!1;if(!f.slice_del())return!1}return!0}function l(){var e;if(f.ket=f.cursor,0==(e=f.find_among_b(p)))return!1;switch(f.bra=f.cursor,e){case 0:return!1;case 1:if(!i())return!1;if(!f.slice_del())return!1;f.ket=f.cursor;e:{var r=f.limit-f.cursor;if(f.eq_s_b("u")){f.bra=f.cursor;var t=f.limit-f.cursor;if(f.eq_s_b("g")){f.cursor=f.limit-t;break e}}if(f.cursor=f.limit-r,!f.eq_s_b("i"))return!1;f.bra=f.cursor;var n=f.limit-f.cursor;if(!f.eq_s_b("c"))return!1;f.cursor=f.limit-n}if(!i())return!1;if(!f.slice_del())return!1;break;case 2:if(!f.slice_from("c"))return!1}return!0}var f=new e,g=[["",-1,3],["ã",0,1],["õ",0,2]],v=[["",-1,3],["a~",0,1],["o~",0,2]],d=[["ic",-1,-1],["ad",-1,-1],["os",-1,-1],["iv",-1,1]],m=[["ante",-1,1],["avel",-1,1],["ível",-1,1]],b=[["ic",-1,1],["abil",-1,1],["iv",-1,1]],h=[["ica",-1,1],["ância",-1,1],["ência",-1,4],["logia",-1,2],["ira",-1,9],["adora",-1,1],["osa",-1,1],["ista",-1,1],["iva",-1,8],["eza",-1,1],["idade",-1,7],["ante",-1,1],["mente",-1,6],["amente",12,5],["ável",-1,1],["ível",-1,1],["ico",-1,1],["ismo",-1,1],["oso",-1,1],["amento",-1,1],["imento",-1,1],["ivo",-1,8],["aça~o",-1,1],["uça~o",-1,3],["ador",-1,1],["icas",-1,1],["ências",-1,4],["logias",-1,2],["iras",-1,9],["adoras",-1,1],["osas",-1,1],["istas",-1,1],["ivas",-1,8],["ezas",-1,1],["idades",-1,7],["adores",-1,1],["antes",-1,1],["aço~es",-1,1],["uço~es",-1,3],["icos",-1,1],["ismos",-1,1],["osos",-1,1],["amentos",-1,1],["imentos",-1,1],["ivos",-1,8]],y=[["ada",-1,1],["ida",-1,1],["ia",-1,1],["aria",2,1],["eria",2,1],["iria",2,1],["ara",-1,1],["era",-1,1],["ira",-1,1],["ava",-1,1],["asse",-1,1],["esse",-1,1],["isse",-1,1],["aste",-1,1],["este",-1,1],["iste",-1,1],["ei",-1,1],["arei",16,1],["erei",16,1],["irei",16,1],["am",-1,1],["iam",20,1],["ariam",21,1],["eriam",21,1],["iriam",21,1],["aram",20,1],["eram",20,1],["iram",20,1],["avam",20,1],["em",-1,1],["arem",29,1],["erem",29,1],["irem",29,1],["assem",29,1],["essem",29,1],["issem",29,1],["ado",-1,1],["ido",-1,1],["ando",-1,1],["endo",-1,1],["indo",-1,1],["ara~o",-1,1],["era~o",-1,1],["ira~o",-1,1],["ar",-1,1],["er",-1,1],["ir",-1,1],["as",-1,1],["adas",47,1],["idas",47,1],["ias",47,1],["arias",50,1],["erias",50,1],["irias",50,1],["aras",47,1],["eras",47,1],["iras",47,1],["avas",47,1],["es",-1,1],["ardes",58,1],["erdes",58,1],["irdes",58,1],["ares",58,1],["eres",58,1],["ires",58,1],["asses",58,1],["esses",58,1],["isses",58,1],["astes",58,1],["estes",58,1],["istes",58,1],["is",-1,1],["ais",71,1],["eis",71,1],["areis",73,1],["ereis",73,1],["ireis",73,1],["áreis",73,1],["éreis",73,1],["íreis",73,1],["ásseis",73,1],["ésseis",73,1],["ísseis",73,1],["áveis",73,1],["íeis",73,1],["aríeis",84,1],["eríeis",84,1],["iríeis",84,1],["ados",-1,1],["idos",-1,1],["amos",-1,1],["áramos",90,1],["éramos",90,1],["íramos",90,1],["ávamos",90,1],["íamos",90,1],["aríamos",95,1],["eríamos",95,1],["iríamos",95,1],["emos",-1,1],["aremos",99,1],["eremos",99,1],["iremos",99,1],["ássemos",99,1],["êssemos",99,1],["íssemos",99,1],["imos",-1,1],["armos",-1,1],["ermos",-1,1],["irmos",-1,1],["ámos",-1,1],["arás",-1,1],["erás",-1,1],["irás",-1,1],["eu",-1,1],["iu",-1,1],["ou",-1,1],["ará",-1,1],["erá",-1,1],["irá",-1,1]],w=[["a",-1,1],["i",-1,1],["o",-1,1],["os",-1,1],["á",-1,1],["í",-1,1],["ó",-1,1]],p=[["e",-1,1],["ç",-1,2],["é",-1,1],["ê",-1,1]],x=[17,65,16,0,0,0,0,0,0,0,0,0,0,0,0,0,3,19,12,2],_=0,B=0,D=0;this.stem=function(){var e=f.cursor;r(),f.cursor=e;var a=f.cursor;t(),f.cursor=a,f.limit_backward=f.cursor,f.cursor=f.limit;var s=f.limit-f.cursor;e:{var g=f.limit-f.cursor,v=f.limit-f.cursor,d=f.limit-f.cursor;if(o()||(f.cursor=f.limit-d,u())){f.cursor=f.limit-v;var m=f.limit-f.cursor;if(f.ket=f.cursor,f.eq_s_b("i")){f.bra=f.cursor;var b=f.limit-f.cursor;if(f.eq_s_b("c")&&(f.cursor=f.limit-b,i()&&!f.slice_del()))return!1}f.cursor=f.limit-m}else if(f.cursor=f.limit-g,!c())break e}f.cursor=f.limit-s;var h=f.limit-f.cursor;l(),f.cursor=f.limit-h,f.cursor=f.limit_backward;var y=f.cursor;return n(),f.cursor=y,!0},this.stemWord=function(e){return f.setCurrent(e),this.stem(),f.getCurrent()}}return function(e){return(new r).stemWord(e)}}(),Bravey.Language.PT.TimeEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t="\\b(às\\b|as\\b|em\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"\\b(horas\\b|hrs\\b|h\\b|:\\b)?"+Bravey.Text.WORDSEP+"\\b(e\\b|,\\b|com\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+"\\b(minutos\\b|min\\b|m\\b)?"+Bravey.Text.WORDSEP+"\\b(e\\b|,\\b|:\\b)?"+Bravey.Text.WORDSEP+"([0-9]+)?"+Bravey.Text.WORDSEP+"\\b(segundos\\b|seg\\b|s\\b)?"+Bravey.Text.WORDSEP+"\\b(meia\\b|quinze\\b|quarenta e cinco\\b)?"+Bravey.Text.WORDSEP+"\\b(da noite\\b|da tarde\\b|pm\\b|da manha\\b|am\\b)?"+Bravey.Text.WORDSEP;r.addMatch(new RegExp(t,"gi"),function(e){var r=0;e[2]&&(r=1*e[2]);var t=0;e[5]?t=1*e[5]:e[10]&&("meia"===e[10]?t=30:"quinze"===e[10]?t=15:"quarenta e cinco"===e[10]&&(t=45));var n=0;return e[8]&&(n=1*e[8]),e[11]&&(("da manha"==e[11]||"am"==e[11])&&r>12&&(r-=12),("da noite"==e[11]||"da tarde"==e[11]||"pm"==e[11])&&r<12&&(r+=12)),Bravey.Text.pad(r,2)+":"+Bravey.Text.pad(t,2)+":"+Bravey.Text.pad(n,2)}),r.bindTo(this)},Bravey.Language.PT.TimePeriodEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e);r.addMatch(new RegExp("\\b(de madrugada|na madrugada)\\b","gi"),function(e){return{start:"00:00:00",end:"05:59:59"}}),r.addMatch(new RegExp("\\b(de manha|na manha)\\b","gi"),function(e){return{start:"06:00:00",end:"11:59:59"}}),r.addMatch(new RegExp("\\b(a tarde|de tarde|na tarde)\\b","gi"),function(e){return{start:"12:00:00",end:"17:59:59"}}),r.addMatch(new RegExp("\\b(a noite|de noite|na noite)\\b","gi"),function(e){return{start:"18:00:00",end:"23:59:59"}}),r.addMatch(new RegExp("\\b(daqui a|daqui|em)\\b"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"\\b(horas|minutos|segundos)\\b"+Bravey.Text.WORDSEP,"gi"),function(e){if(e[2]&&e[3]){var r=1*e[2],t=0;switch(e[3]){case"horas":t=Bravey.Date.HOUR*r;break;case"minutos":t=Bravey.Date.MINUTE*r;break;case"segundos":t=Bravey.Date.SECOND*r}var n=new Date,i=new Date;return i.setTime(i.getTime()+t),{start:n.toLocaleTimeString("pt-BR"),end:i.toLocaleTimeString("pt-BR")}}}),r.bindTo(this)},Bravey.Language.PT.DateEntityRecognizer=function(e){var r=new Bravey.RegexEntityRecognizer(e),t="\\b(de\\b)?"+Bravey.Text.WORDSEP,n=new Bravey.Text.RegexMap([{str:["janeiro~","jan~","1~","01~"],val:0},{str:["fevereiro~","fev~","2~","02~"],val:1},{str:["março~","mar~","3~","03~"],val:2},{str:["abril~","abr~","4~","04~"],val:3},{str:["maio~","mai~","5~","05~"],val:4},{str:["junho~","jun~","6~","06~"],val:5},{str:["julho~","jul~","7~","07~"],val:6},{str:["agosto~","ago~","8~","08~"],val:7},{str:["setembro~","set~","9~","09~"],val:8},{str:["outubro~","out~","10~"],val:9},{str:["novembro~","nov~","11~"],val:10},{str:["dezembro~","dez~","12~"],val:11}],0);r.addMatch(new RegExp("\\b(([0-9]{1,2})(/|-)([0-9]{1,2})((/|-)([0-9]{2,4}))?)\\b","gi"),function(e){var r=new Date,t=r.getFullYear();if(e[2]&&e[4]){var n=1*e[2],i=1*e[4]-1;return e[7]&&(t=1*e[7]),Bravey.Date.formatDate(new Date(t,i,n,0,0,0,0).getTime())}}),r.addMatch(new RegExp("([0-9]{1,2})(°)?"+Bravey.Text.WORDSEP+"(de)"+Bravey.Text.WORDSEP+n.regex()+Bravey.Text.WORDSEP+"(de\\b)?"+Bravey.Text.WORDSEP+"([0-9]{2,4})?\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=r.getMonth(),a=r.getDate();return e[1]&&(a=1*e[1]),e[4]&&(i=n.get(e,4,i)),e[6]&&(t=1*e[6]),t=Bravey.Date.centuryFinder(t),Bravey.Date.formatDate(new Date(t,i,a,0,0,0,0).getTime())}),r.addMatch(new RegExp(n.regex()+Bravey.Text.WORDSEP+"(de)"+Bravey.Text.WORDSEP+"([0-9]{2,4})\\b","gi"),function(e){var r=new Date,t=r.getFullYear(),i=r.getMonth();return e[1]&&(i=n.get(e,1,i)),e[3]&&(t=1*e[3]),t=Bravey.Date.centuryFinder(t),Bravey.Date.formatDate(new Date(t,i,1,0,0,0,0).getTime())}),r.addMatch(new RegExp(t+"(hoje)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime())}),r.addMatch(new RegExp(t+"(amanhã)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(depois de amanhã)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()+2*Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(ontem)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-Bravey.Date.DAY)}),r.addMatch(new RegExp(t+"(anteontem)\\b","gi"),function(e){return Bravey.Date.formatDate((new Date).getTime()-2*Bravey.Date.DAY)}),r.addMatch(new RegExp("\\b(daqui a|daqui|em)\\b"+Bravey.Text.WORDSEP+"([0-9]+)"+Bravey.Text.WORDSEP+"\\b(semanas|dias)\\b"+Bravey.Text.WORDSEP,"gi"),function(e){if(e[2]&&e[3]){var r=1*e[2],t=0;switch(e[3]){case"semanas":t=7*Bravey.Date.DAY*r;break;case"dias":t=Bravey.Date.DAY*r}var n=new Date,i=new Date;return i.setTime(i.getTime()+t),{start:Bravey.Date.formatDate(n),end:Bravey.Date.formatDate(i)}}}),r.bindTo(this)},Bravey.Language.PT.FreeTextEntityRecognizer=function(e,r){var t=["obrigado","por favor"],n=new Bravey.FreeTextEntityRecognizer(e,r);n.addConjunction("é"),n.addConjunction("deve ser"),n.addConjunction("pode ser"),n.addConjunction("talvez seja"),n.addConjunction("o"),n.addConjunction("a"),n.addConjunction("e"),n.addConjunction("esta");for(var i=0;i<t.length;i++)n.addConjunction(t[i]),n.addConjunction(","+t[i]),n.addConjunction(", "+t[i]);return n},Bravey.Language.PT.Numbers={wordsSeparator:/(\w+)/gi,sum:{e:0,zero:0,um:1,dois:2,"três":3,quatro:4,cinco:5,seis:6,sete:7,oito:8,nove:9,dez:10,onze:11,doze:12,treze:13,catorze:14,quinze:15,dezesseis:16,dezessete:17,dezoito:18,dezenove:19,vinte:20,trinta:30,quarenta:40,cinquenta:50,sessenta:60,setenta:70,oitenta:80,noventa:90,cem:100,duzentos:200,trezentos:300,quatrocentos:400,quinhentos:500,seiscentos:600,setecentos:700,oitocentos:800,novecentos:900},mul:{cento:100,mil:1e3,"milhão":1e6},skip:{e:1}},Bravey.Language.PT.NumberEntityRecognizer=function(e,r){this.getName=function(){return e},this.getEntities=function(t,n){n||(n=[]);for(var i,a,s,o,u,c,l=t.toLowerCase().split(/(\w+)/),f=0,g=0,v=0,d=0;d<l.length+1;d++){if(a=void 0==l[d]?"*":l[d],s=!0,o||(u=0,o={value:0,entity:e,string:"",priority:r||0}),a.trim()){if("e"==a.trim()&&0==g){v+=a.length;continue}null!=Bravey.Language.PT.Numbers.sum[a]?g+=Bravey.Language.PT.Numbers.sum[a]:isNaN(1*a)?Bravey.Language.PT.Numbers.mul[a]?(i=Bravey.Language.PT.Numbers.mul[a],f+=g*i,g=0):s=!1:u?(d--,a="",s=!1):f=1*a,s?(u=1,c=v+a.length,void 0==o.position&&(o.position=v)):u&&(o.value=f+g,o.string=t.substr(o.position,c-o.position),n.push(o),f=g=o=0)}v+=a.length}return n}},Bravey.Nlp.Fuzzy=function(e,r){function t(e){e.sort(function(e,r){return e.position<r.position?-1:e.position>r.position?1:e.string.length>r.string.length?-1:e.string.length<r.string.length?1:e.priority>r.priority?-1:e.priority<r.priority?1:0})}function n(e,r){for(var n=[],i={},a=0;a<r.length;a++)i[r[a].entity]||(i[r[a].entity]=1,l[r[a].entity].getEntities(e,n));return t(n),n}function i(e,r){for(var t,i,a,s=n(e,r.entities),o=[],u={},c=[],l=-1,f="",g=!1,v=!1,d=!1,m={},b=0,h=0;h<s.length;h++)if(t=s[h].entity,s[h].position>=l)if(r.index[t])if(void 0==m[t]&&(m[t]=0),i=r.index[t][m[t]]){m[t]++,b++;var y={position:s[h].position,entity:t,value:s[h].value,string:s[h].string,id:i};o.push(y),u[y.id]=y,a=-1==l?e.substr(0,s[h].position):e.substr(l,s[h].position-l),a.length&&c.push({string:a}),c.push(y),f+=a,f+="{"+t+"}",l=s[h].position+s[h].string.length}else g=!0;else v=!0;return a=e.substr(-1==l?0:l),a.length&&(a.length&&c.push({string:a}),f+=a),{found:b,missingEntities:d,exceedEntities:g,extraEntities:v,text:f,entities:o,sentence:c,entitiesIndex:u}}function a(e,r,t){for(var i,a,s="",o=-1,u=-1,c=n(e,f),l={},g=0;g<c.length;g++)i=c[g].entity,c[g].position>u&&(o++,r.index[i]||(r.index[i]=[]),void 0==l[i]?l[i]=0:l[i]++,a=r.index[i][l[i]],a||(a=r.index[i][l[i]]=t&&t[o]?t[o]:i+(l[i]?l[i]:""),r.entities.push({entity:i,id:a}),console.info("Adding entity",a,"to",r.name)),s+=-1==u?e.substr(0,c[g].position):e.substr(u,c[g].position-u),s+="{"+i+"}",u=c[g].position+c[g].string.length);return s+=e.substr(-1==u?0:u),{text:s}}function s(e,r,t){var n,i=-1,a={};return e.replace(/\{([.a-z_-]+)\}/g,function(e,s){i++,r.index[s]||(r.index[s]=[]),void 0==a[s]?a[s]=0:a[s]++,(n=r.index[s][a[s]])||(n=r.index[s][a[s]]=t&&t[i]?t[i]:s+(a[s]?a[s]:""),r.entities.push({entity:s,id:n}),console.info("Adding entity",n,"to",r.name))}),{text:e}}function o(e){for(var r,t,i,a=[],s={},o=[],u="",c={},l=-1,g=-1,v=0,d=n(e,f),m=0;m<d.length;m++)if(t=d[m].entity,d[m].position>l){v++,g++,void 0==c[t]?c[t]=0:c[t]++,i=t+(c[t]?c[t]:"");var b={position:d[m].position,entity:t,value:d[m].value,string:d[m].string,id:i};a.push(b),s[b.id]=b,r=-1==l?e.substr(0,d[m].position):e.substr(l,d[m].position-l),r.length&&o.push({string:r}),o.push(b),u+=r,u+="{"+t+"}",l=d[m].position+d[m].string.length}return r=e.substr(-1==l?0:l),r.length&&(r.length&&o.push({string:r}),u+=r),{found:v,text:u,entities:a,sentence:o,entitiesIndex:s}}r=r||{};var u={},c=new Bravey.DocumentClassifier(r),l={},f=[],g=.75;this.addIntent=function(e,r){for(var t={},n=0;n<r.length;n++)t[r[n].entity]||(t[r[n].entity]=[]),t[r[n].entity].push(r[n].id);return u[e]={name:e,entities:r,index:t},!0},this.addEntity=function(e){var r=e.getName();return l[r]||f.push({entity:r,id:"none"}),l[r]=e,!0},this.hasEntity=function(e){return!!l[e]},this.setConfidence=function(e){g=e},this.getConfidence=function(e){return g},this.addDocument=function(e,r,t){if(t){if(t.fromFullSentence){if(e=Bravey.Text.clean(e),t.expandIntent){u[r]||(console.info("Adding intent",r),this.addIntent(r,[]));var n=a(e,u[r],t.withNames);return c.addDocument(n.text,r)}}else if(t.fromTaggedSentence&&t.expandIntent){u[r]||(console.info("Adding intent",r),this.addIntent(r,[]));var n=s(e,u[r],t.withNames);return c.addDocument(n.text,r)}return console.info("Can't guess..."),!1}return u[r]?c.addDocument(Bravey.Text.clean(e),r):(console.warn("Can't find intent",r),!1)},this.test=function(e,r){switch(e=Bravey.Text.clean(e),r){case"anyEntity":var t=o(e),n=c.classifyDocument(t.text);return t.score=n.winner.score,t.intent=n.winner.label,t;default:var n,a,t=!1,s=-1,l=-1;for(var f in u)a=i(e,u[f]),a.exceedEntities||a.extraEntities||a.missingEntities||(n=c.classifyDocument(a.text),n.scores[f]>g&&(n.scores[f]>s||n.scores[f]==s&&a.found>l)&&(t=a,t.score=s=n.scores[f],l=t.found,t.intent=f));return t}return!1}},Bravey.Nlp.Sequential=function(e,r){function t(e){return e.split(/~/)[0]}function n(e){e.sort(function(e,r){return e.position<r.position?-1:e.position>r.position?1:e.string.length>r.string.length?-1:e.string.length<r.string.length?1:e.priority>r.priority?-1:e.priority<r.priority?1:0})}function i(e,r){for(var t=[],i={},a=0;a<r.length;a++)i[r[a].entity]||(i[r[a].entity]=1,l[r[a].entity].getEntities(e,t));return n(t),t}function a(e,r,t){for(var n,a,s=r||"",o="",u=[],c={},l=0,g=-1,v=i(e,f),d=0;d<v.length;d++)a=v[d].entity,v[d].position>=g&&(s+="~"+a,void 0==c[a]?c[a]=0:c[a]++,n=t&&t[l]?t[l]:a+(c[a]?c[a]:""),u.push({entity:a,id:n}),o+=-1==g?e.substr(0,v[d].position):e.substr(g,v[d].position-g),o+="{"+a+"}",g=v[d].position+v[d].string.length,l++);return o+=e.substr(-1==g?0:g),{error:!1,text:o,name:s,entities:u}}function s(e,r,t){var n,i=-1,a={},s=r||"",o=[],a={},i=0,u=!1;return e.replace(/\{([.a-z_-]+)\}/g,function(e,r){l[r]?(s+="~"+r,void 0==a[r]?a[r]=0:a[r]++,n=t&&t[i]?t[i]:r+(a[r]?a[r]:""),o.push({entity:r,id:n}),i++):u=r}),{error:u,text:e,name:s,entities:o}}function o(e,r){function t(){for(;r.entities[c]&&l[r.entities[c].entity].expand;){var t={position:u<0?0:u,entity:r.entities[c].entity,value:"",string:e.substr(u<0?0:u),id:r.entities[c].id};o[t.id]=t,s.push(t),c++}}var n,a=i(e,r.entities),s=[],o={},u=-1,c=0;if(t(),a.length){for(var f=0;f<a.length;f++)if(n=a[f].entity,a[f].position>=u&&r.entities[c].entity==n){var g={position:a[f].position,entity:n,value:a[f].value,string:a[f].string,id:r.entities[c].id};if(s.push(g),o[g.id]=g,u=a[f].position+a[f].string.length,c++,t(),c>=r.entities.length)break}}else r.entities.length;for(var v,d,m="",b="",u=0,h=[],f=0;f<s.length;f++)l[s[f].entity].expand&&(v=s[f+1],v&&(s[f].string=s[f].string.substr(0,v.position-s[f].position)),d=s[f].position,l[s[f].entity].expand(s[f]),l[s[f].entity].position>d&&(b=e.substr(u,l[s[f].entity].position-d),h.push({string:b}),m+=b,u+=l[s[f].entity].position-d)),b=e.substr(u,s[f].position-u),b&&(h.push({string:b}),m+=b),h.push(s[f]),m+="{"+s[f].entity+"}",u=s[f].position+s[f].string.length;return(b=e.substr(u))&&(h.push({string:b}),m+=b),{found:s.length,exceedEntities:!1,missingEntities:s.length<r.entities.length,extraEntities:s.length>r.entities.length,text:m,entities:s,sentence:h,entitiesIndex:o}}r=r||{};var u={},c=new Bravey.DocumentClassifier(r),l={},f=[],g=.75;this.addIntent=function(e,r){for(var t={},n=e,i=0;i<r.length;i++)n+="~"+r[i].entity,t[r[i].entity]||(t[r[i].entity]=[]),t[r[i].entity].push(r[i].id);return u[n]={name:n,root:e,entities:r,index:t},!0},this.addEntity=function(e){var r=e.getName();return l[r]||f.push({entity:r,id:"none"}),l[r]=e,!0},this.hasEntity=function(e){return!!l[e]},this.setConfidence=function(e){g=e},this.getConfidence=function(e){return g},this.addDocument=function(e,r,n){if(n){if(n.fromFullSentence){if(e=Bravey.Text.clean(e),n.expandIntent){var i=a(e,r,n.withNames);return u[i.name]||(console.info("Adding intent",i.name),this.addIntent(r,i.entities)),c.addDocument(i.text,r)}}else if(n.fromTaggedSentence){var i=s(e,r,n.withNames);return!1!==i.error?(console.warn("Can't find entity typed",i.error),!1):(u[i.name]||(console.info("Adding intent",i.name),this.addIntent(r,i.entities)),c.addDocument(i.text,r))}return console.info("Can't guess..."),!1}return u[r]?c.addDocument(Bravey.Text.clean(e),t(r)):(console.warn("Can't find intent",r),!1)},this.test=function(e,r){e=Bravey.Text.clean(e);var t,n,i,a=!1,s=-1,l=-1;for(var f in u)i=o(e,u[f]),i.exceedEntities||i.extraEntities||i.missingEntities||(n=c.classifyDocument(i.text),(t=n.scores[u[f].root])>g&&(t>s||i.found>l)&&(a=i,a.score=s=t,l=a.found,a.intent=u[f].root));return a}},Bravey.ApiAiAdapter=function(e,r){function t(e){return e.replace(/[^a-z0-9:]/g,"_")}function n(){Bravey.File.load(a[f],function(e){s[a[f]]=e,f++,a[f]?n():i()})}function i(){for(var e,r={},n=0;n<u.length;n++){for(var i=JSON.parse(s[u[n].file]),a=new Bravey.StringEntityRecognizer(u[n].name),f=0;f<i.entries.length;f++)for(var g=0;g<i.entries[f].synonyms.length;g++)a.addMatch(i.entries[f].value,i.entries[f].synonyms[g]);c.addEntity(a)}for(var n=0;n<o.length;n++)for(var i=JSON.parse(s[o[n].file]),f=0;f<i.userSays.length;f++){for(var v="",d=!1,g=0;g<i.userSays[f].data.length;g++)i.userSays[f].data[g].meta?(e=i.userSays[f].data[g].meta.substr(1),v+="{"+e+":"+i.userSays[f].data[g].alias+"}"):v+=i.userSays[f].data[g].text.replace(/\@([.a-z0-9_-]+):([.a-z0-9_-]+)/g,"{$1:$2}");var m=[];v=v.replace(/\{([.a-z0-9_-]+):([.a-z0-9_-]+)\}/g,function(e,n,a){return n=t(n),a=t(a),c.hasEntity(n)||(d=!0,r[n]||(console.warn("Missing entity",n,i.userSays[f].data),r[n]=1)),m.push(a),"{"+n+"}"}),d||c.addDocument(v.trim(),o[n].name,{fromTaggedSentence:!0,expandIntent:!0,withNames:m})}l()}r=r||{};var a=[],s={},o=[],u=[],c=new Bravey.Nlp[r.nlp||"Fuzzy"]("apiai",{stemmer:Bravey.Language[r.language].Stemmer,filter:r.filter});c.addEntity(new Bravey.Language[r.language].NumberEntityRecognizer("sys_number")),c.addEntity(new Bravey.Language[r.language].TimeEntityRecognizer("sys_time")),c.addEntity(new Bravey.Language[r.language].DateEntityRecognizer("sys_date")),c.addEntity(new Bravey.Language[r.language].TimePeriodEntityRecognizer("sys_time_period"));var l,f=0;this.loadIntent=function(r){var t=e+"/intents/"+r+".json";a.push(t),o.push({file:t,name:r})},this.loadEntity=function(r){var t=e+"/entities/"+r+".json";a.push(t),u.push({file:t,name:r})},this.prepare=function(e){l=e,n()},this.test=function(e,r){var t=this.nlp.test(e,r);if(t){var n={result:{source:"agent",resolvedQuery:e,action:"",actionIncomplete:!1,parameters:{},contexts:[],metadata:{intentName:""},fulfillment:{speech:""},score:0},status:{code:200,errorType:"success"}};n.result.metadata.intentName=t.intent,n.result.score=t.score;for(var i in t.entitiesIndex)n.result.parameters[i]=t.entitiesIndex[i].value;return n}return{result:{resolvedQuery:e,contexts:[],metadata:{},fulfillment:{speech:""},score:0},status:{code:200,errorType:"success"}}},this.nlp=c},Bravey.ContextManager=function(e){e=e||{};var r=["default"],t={},n={},i=e.sessionManager||new Bravey.SessionManager.InMemorySessionManager(e);this.addNlp=function(e,i,a){i||(i=r);for(var s=0;s<i.length;s++)t[i[s]]||(t[i[s]]=[],n[i[s]]=[]),-1==t[i[s]].indexOf(e)&&(t[i[s]].push(e),n[i[s]].push({method:a}))},this.removeNlp=function(e,r){var i;if(r)for(var a=0;a<r.length;a++)-1!=(i=t[r[a]].indexOf(e))&&(t[r[a]].splice(i,1),n[r[a]].splice(i,1));else for(var a in t)-1!=(i=t[a].indexOf(e))&&(t[a].splice(i,1),n[a].splice(i,1))},this.removeContext=function(e){t[e]&&delete t[e]},this.setSessionIdContext=function(e,r){return i.setContext(e,r)},this.setSessionIdData=function(e,r){return i.setData(e,r)},this.clearSessionIdData=function(e){return i.clearData(e)},this.getSessionIdData=function(e){return i.getData(e)},this.reserveSessionId=function(e){return i.reserveSessionId(e)},this.testByContext=function(e,i){var a,s={result:!1};i||(i=r);for(var o=0;o<i.length;o++)if(t[i[o]])for(var u=0;u<t[i[o]].length;u++)a=t[i[o]][u].test(e,n[i[o]][u].method),(!s.result||a.score&&a.score>s.result.score||a.score==s.result.score||a.found>s.result.found)&&(s.result=a,s.context=i[o]);return s},this.testBySessionId=function(e,r){var t={result:!1};if(void 0===r?r=i.reserveSessionId():i.keepAlive(r)){var n=i.getContext(r);t=this.testByContext(e,n),t.sessionId=r,t.sessionContext=n,t.sessionData=i.getData(r)}return t}},Bravey.SessionManager.InMemorySessionManager=function(e){function r(){return(new Date).getTime()}function t(){var e=r();for(var t in i)e-i[t].timestamp>a&&delete i[t]}function n(){return{context:["default"],data:{},timestamp:r()}}e||(e={});var i={},a=e.sessionLength||6e5;this.reserveSessionId=function(e){if(void 0==e)do{e=Bravey.Text.generateGUID()}while(i[e]);return t(),i[e]||(i[e]=n()),e},this.keepAlive=function(e){return!!i[e]&&(i[e].timestamp=r(),!0)},this.setContext=function(e,r){return!!i[e]&&(i[e].context=r,this.keepAlive(e),!0)},this.setData=function(e,r){if(i[e]){for(var t in r)i[e].data[t]=r[t];return this.keepAlive(e),!0}return!1},this.clearData=function(e,r){return!!i[e]&&(i[e].data={},this.keepAlive(e),!0)},this.getContext=function(e){if(i[e])return i[e].context},this.getData=function(e){if(i[e])return i[e].data}},Bravey.Filter.BasicFilter=function(e){for(var r=[],t=0;t<e.length;t++)"{"!=e[t][0]&&e[t].length>3&&r.push(e[t]);return r.length<3?e:r};